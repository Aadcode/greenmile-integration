import{jsx as r,jsxs as n,Fragment as e}from"react/jsx-runtime";import{useState as t,useEffect as i,Fragment as o}from"react";import a from"react-dom";import{Transition as c,Dialog as s}from"@headlessui/react";import{Text as l,Button as d}from"@medusajs/ui";var u=function(){return u=Object.assign||function(r){for(var n,e=1,t=arguments.length;e<t;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i]);return r},u.apply(this,arguments)};function m(r,n,e,t){return new(e||(e=Promise))((function(i,o){function a(r){try{s(t.next(r))}catch(r){o(r)}}function c(r){try{s(t.throw(r))}catch(r){o(r)}}function s(r){var n;r.done?i(r.value):(n=r.value,n instanceof e?n:new e((function(r){r(n)}))).then(a,c)}s((t=t.apply(r,n||[])).next())}))}function p(r,n){var e,t,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=c(0),a.throw=c(1),a.return=c(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(c){return function(s){return function(c){if(e)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(o=0)),o;)try{if(e=1,t&&(i=2&c[0]?t.return:c[0]?t.throw||((i=t.return)&&i.call(t),0):t.next)&&!(i=i.call(t,c[1])).done)return i;switch(t=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,t=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=n.call(r,o)}catch(r){c=[6,r],t=0}finally{e=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}function g(r,n){void 0===n&&(n={});var e=n.insertAt;if(r&&"undefined"!=typeof document){var t=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===e&&t.firstChild?t.insertBefore(i,t.firstChild):t.appendChild(i),i.styleSheet?i.styleSheet.cssText=r:i.appendChild(document.createTextNode(r))}}"function"==typeof SuppressedError&&SuppressedError;g("@import url('https://fonts.googleapis.com/css2?family=Jost:wght@400;500;700&display=swap');\r\n\r\n/* src/styles/ProductModal.css */\r\n.gm-modal-overlay {\r\n  display: flex;\r\n  position: fixed;\r\n  z-index: 9999999 !important;\r\n  left: 0;\r\n  top: 0;\r\n  width: 100%;\r\n  height: 100vh;\r\n  background-color: rgba(0, 0, 0, 0.6);\r\n  text-align: left;\r\n  pointer-events: auto;\r\n  align-items: center;\r\n  justify-content: center;\r\n  font-family: 'Jost', var(--font-jost), -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\r\n}\r\n\r\n.gm-modal-content {\r\n  max-width: 700px; /* Increased for wider content */\r\n  width: 100%;\r\n  margin: 0 auto;\r\n  background-color: white;\r\n  border-radius: 8px;\r\n  overflow: auto; /* Changed from hidden to auto to allow scrolling if needed */\r\n  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);\r\n  display: flex;\r\n  flex-direction: column;\r\n  max-height: 95% !important; /* Prevent modal from being taller than the viewport */\r\n  font-family: 'Jost', sans-serif !important;\r\n}\r\n\r\n/* Header */\r\n.gm-modal-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  border-bottom: 1px solid #f3f3f3;\r\n  padding: 5px 5px 0px 10px;\r\n}\r\n\r\n.gm-modal-title {\r\n  font-weight: 600 !important;\r\n  font-size: 16px !important;\r\n  margin: 0px !important;\r\n  padding: 0px !important;\r\n  margin-bottom: 5px !important;\r\n  color: #111827;\r\n}\r\n\r\n.gm-close-button {\r\n  background: none;\r\n  border: none;\r\n  color: #111827;\r\n  cursor: pointer;\r\n  padding: 4px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n/* Product Slider */\r\n.gm-product-slider {\r\n  position: relative;\r\n  height: auto;\r\n  min-height: 240px; /* Reduced from 400px */\r\n  max-height: 240px; /* Reduced from 60vh */\r\n  background-color: #ffffff;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.gm-product-image {\r\n  max-height: 30vh; /* Reduced from 55vh */\r\n  max-width: 90%; /* Reduced from 95% */\r\n  width: auto;\r\n  object-fit: contain;\r\n  display: block;\r\n}\r\n\r\n.gm-no-image {\r\n  color: #6b7280;\r\n  font-size: 14px;\r\n}\r\n\r\n.gm-slider-arrow {\r\n  position: absolute;\r\n  top: 50%;\r\n  transform: translateY(-50%);\r\n  background-color: white;\r\n  width: 30px;\r\n  height: 30px;\r\n  border-radius: 50%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\r\n  border: none;\r\n  cursor: pointer;\r\n  z-index: 1;\r\n}\r\n\r\n.gm-slider-next {\r\n  right: 10px;\r\n}\r\n\r\n.gm-slider-prev {\r\n  left: 10px;\r\n}\r\n\r\n/* Product Details */\r\n.gm-product-details {\r\n  display: flex;\r\n  flex-direction: column;\r\n  padding: 0;\r\n}\r\n\r\n.gm-product-brand {\r\n  padding: 16px 16px 0;\r\n  text-align: left;\r\n}\r\n\r\n.gm-vendor {\r\n  text-transform: uppercase;\r\n  font-weight: 700;\r\n  font-size: 14px;\r\n  letter-spacing: 0.05em;\r\n  margin: 0 0 4px;\r\n  color: #111827;\r\n  text-align: left;\r\n}\r\n\r\n.gm-product-title {\r\n  color: #111827;\r\n  margin: 0 0 16px;\r\n  font-size: 18px;\r\n  font-weight: 500;\r\n  text-align: left;\r\n  text-decoration: underline;\r\n}\r\n\r\n/* Price Section */\r\n.gm-price-section {\r\n  background-color: #f2faf5;\r\n  padding: 16px;\r\n  margin-bottom: 16px;\r\n  text-align: left;\r\n}\r\n\r\n.gm-price-row {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 5px;\r\n  text-align: left;\r\n}\r\n\r\n.gm-price-row:last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n.gm-price-label {\r\n  color: #4b5563;\r\n  font-size: 15px;\r\n  text-align: left;\r\n}\r\n\r\n.gm-price-value {\r\n  font-weight: 500;\r\n  font-size: 16px;\r\n  text-decoration: line-through;\r\n  text-align: right;\r\n}\r\n\r\n.gm-restock-label {\r\n  font-weight: 700;\r\n  font-size: 15px;\r\n  text-align: left;\r\n}\r\n\r\n.gm-restock-price {\r\n  font-weight: 700;\r\n  font-size: 20px;\r\n  color: #111827;\r\n  text-align: right;\r\n}\r\n\r\n/* Item Description */\r\n.gm-item-description {\r\n  padding: 0 16px;\r\n  margin-bottom: 16px;\r\n}\r\n\r\n.gm-description-title {\r\n  font-weight: 600;\r\n  margin: 0 0 12px;\r\n  font-size: 14px;\r\n  color: #111827;\r\n  text-align: left;\r\n}\r\n\r\n.gm-description-content {\r\n  border: 1px solid #e5e5e5;\r\n  border-radius: 4px;\r\n  padding: 16px;\r\n  text-align: left;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: flex-start;\r\n}\r\n\r\n.gm-quality-indicator {\r\n  display: flex;\r\n  align-items: center;\r\n  margin-bottom: 12px;\r\n  align-self: flex-start;\r\n  text-align: left;\r\n}\r\n\r\n.gm-quality-dot {\r\n  display: inline-block;\r\n  width: 8px;\r\n  height: 8px;\r\n  background-color: #00A827;\r\n  border-radius: 50%;\r\n  margin-right: 6px;\r\n}\r\n\r\n.gm-quality-label {\r\n  text-transform: uppercase;\r\n  font-weight: 700;\r\n  font-size: 14px;\r\n  color: #111827;\r\n  text-align: left;\r\n}\r\n\r\n.gm-remarks-title {\r\n  font-weight: 600;\r\n  margin-bottom: 8px;\r\n  font-size: 14px;\r\n  color: #111827;\r\n  text-align: left;\r\n}\r\n\r\n.gm-remarks-text {\r\n  font-size: 14px;\r\n  color: #4b5563;\r\n  margin-bottom: 0;\r\n  line-height: 1.5;\r\n  text-align: left;\r\n}\r\n\r\n/* CTA Button */\r\n.gm-cta-container {\r\n  padding: 0 16px 16px;\r\n  margin-top: auto;\r\n}\r\n\r\n.gm-cta-button {\r\n  background-color: #00A827;\r\n  color: white;\r\n  text-align: center;\r\n  font-weight: 700;\r\n  padding: 14px;\r\n  width: 100%;\r\n  border: none;\r\n  cursor: pointer;\r\n  border-radius: 4px;\r\n  text-transform: uppercase;\r\n  letter-spacing: 0.025em;\r\n  font-size: 14px;\r\n}\r\n\r\n.gm-final-sale {\r\n  text-align: center;\r\n  font-size: 12px;\r\n  color: #6b7280;\r\n  margin-top: 8px;\r\n}\r\n\r\n/* Responsive Design */\r\n@media (max-width: 480px) {\r\n  .gm-modal-content {\r\n    max-width: 95%;\r\n    height: auto;\r\n    max-height: 100%;\r\n  }\r\n  \r\n  .gm-product-slider {\r\n    min-height: 200px; /* Reduced from 300px */\r\n    max-height: 35vh; /* Reduced from 70vh */\r\n  }\r\n  \r\n  .gm-product-image {\r\n    max-height: 25vh; /* Reduced from 65vh */\r\n    max-width: 90%;\r\n    width: auto;\r\n  }\r\n}\r\n");var h=function(o){var c=o.productInfo,s=o.productTitle,l=o.productVendor,d=void 0===l?"":l,m=o.currency,p=void 0===m?"USD":m,g=o.onClose,h=o.onCheckout;o.apiClient;var f=t(""),v=f[0],x=f[1],y=t(!1);y[0],y[1];var b=t(0),w=b[0],k=b[1],N=t([]),C=N[0],_=N[1],E=t(""),j=E[0],z=E[1],P=t(""),T=P[0],S=P[1],F=t(null),I=F[0],L=F[1];i((function(){if("undefined"!=typeof window){var r=document.getElementById("greenmile-modal-root");return r||((r=document.createElement("div")).id="greenmile-modal-root",document.body.appendChild(r)),L(r),function(){r&&0===r.childElementCount&&document.body.removeChild(r)}}}),[]),i((function(){if(c)if(c.urgency_price&&Object.keys(c.urgency_price).length>0){var r=Object.keys(c.urgency_price);x(r[0])}else if(x("like new"),c.discounted_price)S("string"==typeof c.discounted_price?c.discounted_price:G(c.discounted_price));else if(c.original_price){var n="number"==typeof c.original_price?.85*c.original_price:.85*parseFloat(c.original_price);S(G(n))}}),[c]),i((function(){var r,n;if(v&&c){var e=void 0;c.urgency_price&&c.urgency_price[v]?e=c.urgency_price[v]:c.discounted_price?e=c.discounted_price:c.original_price&&(e="number"==typeof c.original_price?.85*c.original_price:.85*parseFloat(c.original_price)),"string"==typeof e&&e.startsWith("$")?S(e):void 0!==e&&S(G(e)),z((null===(r=c.inspection)||void 0===r?void 0:r[v])||"This item was previously purchased and returned in perfect condition. It has been thoroughly inspected and certified by our quality team.");var t=(null===(n=c.images)||void 0===n?void 0:n[v])||[];t.length?_(t):_(["https://placehold.co/300x300?text=No+Image"]),k(0)}}),[v,c]);var G=function(r){var n="string"==typeof r?parseFloat(r):r;return new Intl.NumberFormat("en",{style:"currency",currency:p,currencyDisplay:"narrowSymbol"}).format(n)};return i((function(){if("undefined"!=typeof window){var r=function(r){"Escape"===r.key&&g()};return window.addEventListener("keydown",r),function(){return window.removeEventListener("keydown",r)}}}),[g]),I?a.createPortal(r("div",u({className:"gm-modal-overlay",onClick:g},{children:n("div",u({className:"gm-modal-content",onClick:function(r){return r.stopPropagation()}},{children:[n("div",u({className:"gm-modal-header"},{children:[r("h3",u({className:"gm-modal-title"},{children:"Like-New Return Available"})),r("button",u({className:"gm-close-button",onClick:g},{children:n("svg",u({xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},{children:[r("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),r("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}))}))]})),n("div",u({className:"gm-product-slider"},{children:[C.length>0?r("img",{src:C[w],alt:"".concat(s," - image ").concat(w+1),className:"gm-product-image"}):r("div",u({className:"gm-no-image"},{children:"No image available"})),C.length>1&&n(e,{children:[r("button",u({className:"gm-slider-arrow gm-slider-prev",onClick:function(){k((function(r){return Math.max(0,r-1)}))},disabled:0===w},{children:r("svg",u({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},{children:r("polyline",{points:"15 18 9 12 15 6"})}))})),r("button",u({className:"gm-slider-arrow gm-slider-next",onClick:function(){k((function(r){return Math.min(C.length-1,r+1)}))},disabled:w===C.length-1},{children:r("svg",u({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},{children:r("polyline",{points:"9 18 15 12 9 6"})}))}))]})]})),n("div",u({className:"gm-product-details"},{children:[n("div",u({className:"gm-product-brand"},{children:[d&&r("h4",u({className:"gm-vendor"},{children:d.toUpperCase()})),r("h2",u({className:"gm-product-title"},{children:s}))]})),n("div",u({className:"gm-price-section"},{children:[n("div",u({className:"gm-price-row"},{children:[r("div",u({className:"gm-price-label"},{children:"Original Price"})),r("div",u({className:"gm-price-value"},{children:(null==c?void 0:c.price)||G((null==c?void 0:c.original_price)||0)}))]})),n("div",u({className:"gm-price-row"},{children:[r("div",u({className:"gm-restock-label"},{children:"Restock Price"})),r("div",u({className:"gm-restock-price"},{children:(null==c?void 0:c.discounted_price)||T}))]}))]})),n("div",u({className:"gm-item-description"},{children:[r("h5",u({className:"gm-description-title"},{children:"Item Description"})),n("div",u({className:"gm-description-content"},{children:[n("div",u({className:"gm-quality-indicator"},{children:[r("span",{className:"gm-quality-dot"}),r("span",u({className:"gm-quality-label"},{children:(null==v?void 0:v.toUpperCase())||"LIKE NEW"}))]})),r("div",u({className:"gm-remarks-title"},{children:"Tags and packaging intact."})),r("p",u({className:"gm-remarks-text"},{children:j||"This item was previously purchased and returned in perfect condition. It has been thoroughly inspected and certified by our quality team, allowing us to offer it at a reduced price."}))]}))]})),n("div",u({className:"gm-cta-container"},{children:[n("button",u({className:"gm-cta-button",onClick:h},{children:["GET THIS DEAL Â· ",T]})),r("div",u({className:"gm-final-sale"},{children:"Final sale, no returns."}))]}))]}))]}))})),I):null};g("/* src/styles/GreenMileWidget.css */\r\n@import url('https://fonts.googleapis.com/css2?family=Jost:ital,wght@0,100..900;1,100..900&display=swap');\r\n\r\n.gm-widget {\r\n  max-width: 480px;\r\n  width: 100%;\r\n  font-family: 'Jost', sans-serif;\r\n  margin: 15px 0;\r\n}\r\n\r\n.deal-card {\r\n  border: 1px solid #e5e5e5;\r\n  border-radius: 4px;\r\n  background-color: white;\r\n  overflow: hidden;\r\n}\r\n\r\n/* Header Section */\r\n.gm-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding: 12px 16px;\r\n  border-bottom: 1px solid #e5e5e5;\r\n}\r\n\r\n.green-text {\r\n  color: #2ca02c;\r\n  font-weight: 500;\r\n}\r\n\r\n.gm-powered-by {\r\n  display: flex;\r\n  align-items: center;\r\n  font-size: 12px;\r\n  color: #6b7280;\r\n}\r\n\r\n.gm-logo {\r\n  margin-left: 4px;\r\n  width: 16px;\r\n  height: 16px;\r\n}\r\n\r\n/* Content Section */\r\n.gm-content {\r\n  padding: 16px;\r\n  padding-bottom: 8px;\r\n}\r\n\r\n/* Buy Button */\r\n.gm-buy-button {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  width: 100%;\r\n  padding: 12px 16px;\r\n  background-color: #2ca02c;\r\n  color: white;\r\n  font-weight: bold;\r\n  border: none;\r\n  border-radius: 4px;\r\n  cursor: pointer;\r\n  font-family: inherit;\r\n  margin-bottom: 8px;\r\n}\r\n\r\n.gm-button-text {\r\n  font-weight: 700;\r\n  font-size: 14px;\r\n  letter-spacing: 0.1em;\r\n  text-transform: uppercase;\r\n}\r\n\r\n.gm-price-container {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.gm-original-price {\r\n  font-size: 14px;\r\n  text-decoration: line-through;\r\n  opacity: 0.8;\r\n  margin-right: 8px;\r\n  color: white;\r\n}\r\n\r\n.gm-discount-price {\r\n  font-size: 18px;\r\n  font-weight: 700;\r\n  color: white;\r\n}\r\n\r\n/* Features Section */\r\n.gm-features {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  gap: 24px;\r\n  padding: 8px 0 16px;\r\n}\r\n\r\n.gm-feature-item {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.check-icon {\r\n  position: relative;\r\n  padding-left: 22px;\r\n  font-size: 12px;\r\n  color: #4b5563;\r\n}\r\n\r\n.check-icon::before {\r\n  content: \"\";\r\n  display: inline-block;\r\n  width: 16px;\r\n  height: 16px;\r\n  background: url('https://i.ibb.co/hFt9sX2x/material-symbols-check-rounded.png') no-repeat;\r\n  background-size: contain;\r\n  position: absolute;\r\n  left: 0;\r\n  top: 50%;\r\n  transform: translateY(-50%);\r\n}\r\n\r\n/* Loading State */\r\n.gm-loading {\r\n  text-align: center;\r\n  padding: 16px;\r\n  color: #6b7280;\r\n}\r\n\r\n/* Modal styles */\r\n.gm-modal-overlay {\r\n  display: flex;\r\n  position: fixed;\r\n  z-index: 9999999 !important;\r\n  left: 0;\r\n  top: 0;\r\n  width: 100%;\r\n  height: 100vh;\r\n  background-color: rgba(0, 0, 0, 0.4);\r\n  text-align: center;\r\n  pointer-events: auto;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.gm-modal-content {\r\n  background-color: white;\r\n  margin: auto;\r\n  padding: 12px;\r\n  border-radius: 8px;\r\n  max-width: 90vw;\r\n  width: 400px;\r\n  max-height: 90vh;\r\n  z-index: 9999999;\r\n  overflow-y: auto;\r\n  height: auto;\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: space-between;\r\n  position: relative;\r\n  padding-bottom: 20px;\r\n}\r\n\r\n.gm-modal-title {\r\n  font-weight: bold;\r\n  font-size: 18px;\r\n  text-align: left;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.gm-close-button {\r\n  position: absolute;\r\n  top: 8px;\r\n  right: 8px;\r\n  color: black;\r\n  background-color: transparent;\r\n  font-size: 17px;\r\n  font-weight: bold;\r\n  cursor: pointer;\r\n  width: 28px;\r\n  height: 28px;\r\n  border-radius: 50%;\r\n  display: flex;\r\n  line-height: 0;\r\n  align-items: center;\r\n  justify-content: center;\r\n  transition: background-color 0.3s ease, color 0.3s ease;\r\n}\r\n\r\n.gm-close-button:hover {\r\n  background-color: #2ca02c;\r\n  color: white;\r\n}\r\n\r\n.gm-delivery-info {\r\n  font-size: 12px;\r\n  color: #555;\r\n  font-weight: bold;\r\n  margin: 5px 0 0 0;\r\n}\r\n");var f=function(e){var o=e.productId,a=e.productTitle,c=e.productVendor,s=void 0===c?"":c,l=e.productPrice,d=e.discountedPrice,g=e.variantId,f=e.handleCheckout,v=e.currency,x=void 0===v?"USD":v,y=e.backendUrl,b=e.storeUrl,w=e.apiClient,k=e.onCheckout,N=t(!1),C=N[0],_=N[1],E=t(null),j=E[0],z=E[1],P=t(!0),T=P[0],S=P[1],F=t(null),I=F[0],L=F[1];i((function(){m(void 0,void 0,void 0,(function(){var r,n,e,t,i,a;return p(this,(function(c){switch(c.label){case 0:return c.trys.push([0,5,6,7]),S(!0),[4,fetch("https://ipinfo.io/json?token=0938f3aebe35e7")];case 1:case 3:return[4,c.sent().json()];case 2:return r=c.sent(),n=r.loc.split(","),e=n[0],t=n[1],[4,fetch("".concat(y,"/medusa/product-info/"),{method:"POST",headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"69420"},body:JSON.stringify({shop:b,product_price:l,product_id:o,variant_id:g,variant:"Default",location:{latitude:e,longitude:t}})})];case 4:return i=c.sent(),z(i),[3,7];case 5:return a=c.sent(),console.error("Error fetching product info:",a),L("Unable to load product information"),[3,7];case 6:return S(!1),[7];case 7:return[2]}}))}))}),[o,g,l,y,b]);if(T)return r("div",u({className:"gm-loading"},{children:"Loading product information..."}));if(I||!j)return console.error("Error or no product info:",I),null;var G=j.price,R=j.discounted_price,D=function(r){if(null==r)return"";if("string"==typeof r&&r.startsWith("$"))return r;var n="string"==typeof r?parseFloat(r):r;return isNaN(n)?"":new Intl.NumberFormat("en",{style:"currency",currency:x,currencyDisplay:"narrowSymbol"}).format(n)};return n("div",u({className:"gm-widget"},{children:[n("div",u({className:"deal-card"},{children:[n("div",u({className:"gm-header"},{children:[r("div",u({className:"green-text"},{children:"Like-New Return Available"})),n("div",u({className:"gm-powered-by"},{children:["Powered by GreenMile",r("img",{src:"https://i.ibb.co/Rkr0W5dx/Green-Mile-Symbol.png",alt:"GreenMile",width:16,height:16,className:"gm-logo"})]}))]})),n("div",u({className:"gm-content"},{children:[n("button",u({className:"gm-buy-button",onClick:function(){return _(!0)}},{children:[r("span",u({className:"gm-button-text"},{children:"GET THIS DEAL"})),n("div",u({className:"gm-price-container"},{children:[r("span",u({className:"gm-original-price"},{children:G||D(l)})),r("span",u({className:"gm-discount-price"},{children:R||D(d)}))]}))]})),n("div",u({className:"gm-features"},{children:[r("div",u({className:"gm-feature-item"},{children:r("span",u({className:"check-icon"},{children:"Like-New Condition"}))})),r("div",u({className:"gm-feature-item"},{children:r("span",u({className:"check-icon"},{children:"Quality Checked"}))})),r("div",u({className:"gm-feature-item"},{children:r("span",u({className:"check-icon"},{children:"Fast Shipping"}))}))]}))]}))]})),"      ","      ",C&&r(h,{productInfo:j,productTitle:a,productVendor:s,currency:x,onClose:function(){return _(!1)},onCheckout:function(){return m(void 0,void 0,void 0,(function(){var r,n;return p(this,(function(e){switch(e.label){case 0:return e.trys.push([0,4,,5]),(null==j?void 0:j.returned_variant)?(r="undefined"!=typeof window&&window.location.pathname.split("/")[1]||"dk","function"!=typeof k?[3,1]:(k(j.returned_variant,j.discount_code||""),[3,3])):[3,3];case 1:return[4,f(j.returned_variant,1,r)];case 2:e.sent(),e.label=3;case 3:return[3,5];case 4:return n=e.sent(),console.error("Checkout failed:",n),[3,5];case 5:return[2]}}))}))},apiClient:w})]}))};function v(r){return!(!r||!r.title)&&r.title.toLowerCase().includes("greenmile")}function x(r,n,e,t){var i;return void 0===n&&(n=1),m(this,void 0,void 0,(function(){var o,a,c,s,l,d,u,m,g,h,f,v;return p(this,(function(p){switch(p.label){case 0:if(p.trys.push([0,11,,12]),console.log("Starting direct checkout with variant: ".concat(r,", quantity: ").concat(n,", country: ").concat(e)),o=void 0,t)o=t;else{if("undefined"==typeof window||!window.sdk)throw new Error("Medusa SDK not available");o=window.sdk}return[4,o.client.fetch("/store/regions",{method:"GET"})];case 1:if(a=p.sent(),console.log("Retrieved regions:",a.regions),!(null==(c=null===(i=a.regions)||void 0===i?void 0:i.find((function(r){var n;return null===(n=r.countries)||void 0===n?void 0:n.some((function(r){return r.iso_2===e.toLowerCase()}))})))?void 0:c.id))throw console.error("Region not found for country code: ".concat(e)),new Error("Region not found for country code: ".concat(e));console.log("Found region: ".concat(c.id," for country: ").concat(e)),s=void 0,p.label=2;case 2:return p.trys.push([2,4,,5]),[4,o.store.cart.create({region_id:c.id})];case 3:return s=p.sent(),[3,5];case 4:throw l=p.sent(),console.error("Error creating cart:",l),l;case 5:d=s.cart.id,console.log("Created cart: ".concat(d)),u=void 0,p.label=6;case 6:return p.trys.push([6,9,,10]),[4,o.store.cart.createLineItem(d,{variant_id:r,quantity:n})];case 7:return u=p.sent(),console.log("Added line item to cart:",u),[4,o.store.cart.retrieve(d)];case 8:if(m=p.sent(),console.log("Cart after adding item:",m),!m.cart.items||0===m.cart.items.length)throw console.error("No items found in cart after adding line item."),new Error("Failed to add item to cart");return[3,10];case 9:throw g=p.sent(),console.error("Error adding item to cart:",g),g;case 10:return"undefined"==typeof document?(console.log("Cart created with ID ".concat(d,", but not in browser environment to set cookie and redirect")),[2]):(document.cookie="_greenmile_cart_id=".concat(d),h=window.location.origin,f="".concat(h,"/").concat(e,"/checkout?step=address"),console.log("Redirecting to: ".concat(f)),window.location.href=f,[3,12]);case 11:throw v=p.sent(),console.error("Direct checkout failed:",v),v;case 12:return[2]}}))}))}var y=function(r,n){return m(void 0,void 0,void 0,(function(){var e,t,i,o,a,c,s,l;return p(this,(function(d){switch(d.label){case 0:return d.trys.push([0,4,,5]),[4,r()];case 1:return(e=d.sent())&&e.id&&Array.isArray(e.items)?(t=function(r){var n;return"greenmile"===(null===(n=null==r?void 0:r.split("-")[0])||void 0===n?void 0:n.trim().toLowerCase())},i=e.items,0===(o=i.filter((function(r){return t(r.title)}))).length?[2,{success:!0,isEmpty:0===i.length}]:(a=function(r,n){return void 0===n&&(n=2),m(void 0,void 0,void 0,(function(){var e,t,i;return p(this,(function(o){switch(o.label){case 0:e=function(e){var t;return p(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,4]),[4,r()];case 1:return i.sent(),[2,{value:void 0}];case 2:if(t=i.sent(),e===n)throw t;return[4,new Promise((function(r){return setTimeout(r,300*(e+1))}))];case 3:return i.sent(),[3,4];case 4:return[2]}}))},t=0,o.label=1;case 1:return t<=n?[5,e(t)]:[3,4];case 2:if("object"==typeof(i=o.sent()))return[2,i.value];o.label=3;case 3:return t++,[3,1];case 4:return[2]}}))}))},c=o.map((function(r){return a((function(){return n(r.id)}))})),[4,Promise.all(c)])):(console.error("Cart not found or invalid"),[2,{success:!1,isEmpty:!0}]);case 2:return d.sent(),[4,r()];case 3:return s=d.sent(),[2,{success:!0,isEmpty:!s||0===s.items.length}];case 4:return l=d.sent(),console.error("Failed to remove Greenmile products:",l),[2,{success:!1,isEmpty:!1}];case 5:return[2]}}))}))},b=function(r){return m(void 0,void 0,void 0,(function(){var n,e,t;return p(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,r()];case 1:return n=i.sent(),(null===(t=null==n?void 0:n.items)||void 0===t?void 0:t.length)?[2,n.items.some((function(r){return!!r.variant&&v(r.variant)}))]:[2,!1];case 2:return e=i.sent(),console.error("Error checking for Greenmile variants in cart:",e),[2,!1];case 3:return[2]}}))}))};function w(r){return m(this,void 0,void 0,(function(){var n,e,t,i;return p(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,fetch("/store/variants/".concat(r))];case 1:return(n=o.sent()).ok?[4,n.json()]:(console.error("Failed to fetch variant for cart validation:",n.status),[2,!0]);case 2:return e=o.sent(),v(t=e.variant)?(console.warn("Prevented adding Greenmile variant to cart:",t.title),[2,!1]):[2,!0];case 3:return i=o.sent(),console.error("Error in cart validation:",i),[2,!0];case 4:return[2]}}))}))}var k={excludePrefixes:[],customFilter:void 0};function N(r,n){if(!r||!n||0===n.length)return!1;var e=r.toLowerCase();return n.some((function(r){return e.startsWith(r.toLowerCase())}))}function C(r,n){void 0===n&&(n=k);var e=u(u({},k),n);if(!r)return r;var t=r.variants?r.variants.filter((function(r){return!r.title||!(e.excludePrefixes&&e.excludePrefixes.length>0&&N(r.title,e.excludePrefixes))&&(!e.customFilter||e.customFilter(r))})):[],i=r.options?function(r,n){return r&&0!==r.length&&n&&0!==n.length?r.map((function(r){return u(u({},r),{values:r.values?r.values.filter((function(r){var e;return!N(null!==(e=r.value)&&void 0!==e?e:"",n)})):[]})})):r}(r.options,e.excludePrefixes||[]):[];return u(u({},r),{variants:t,options:i})}function _(r){var n=r.retrieveCartFunc;return m(this,void 0,void 0,(function(){var r,e;return p(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,n()];case 1:return(r=t.sent())&&r.items&&0!==r.items.length&&r.items[0].title&&"greenmile"===r.items[0].title.split("-")[0].toLowerCase()?[2,"greenmile"]:[2,"medusa"];case 2:return e=t.sent(),console.error("Error determining cart source:",e),[2,"medusa"];case 3:return[2]}}))}))}function E(e){var a=this,g=e.retrieveCartFunc,h=e.pathname,f=e.deleteLineItems,x=t(!1),b=x[0],w=x[1],k=t([]),N=k[0],C=k[1],_=t(!1),E=_[0],j=_[1];i((function(){if(!h.includes("/checkout")){m(a,void 0,void 0,(function(){var r,n,e;return p(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,g()];case 1:return(r=t.sent())&&r.items?((n=r.items.filter((function(r){return v(r.variant)})).map((function(r){return r.variant}))).length>0&&(C(n),w(!0)),[3,3]):[2];case 2:return e=t.sent(),console.error("Error checking cart for Greenmile variants:",e),[3,3];case 3:return[2]}}))}))}}),[h]);var z=function(){w(!1)};return 0===N.length?null:r(c,u({appear:!0,show:b,as:o},{children:n(s,u({as:"div",className:"relative z-50",onClose:z},{children:[r(c.Child,u({as:o,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0"},{children:r("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm"})})),r("div",u({className:"fixed inset-0 overflow-y-auto"},{children:r("div",u({className:"flex min-h-full items-center justify-center p-4 text-center"},{children:r(c.Child,u({as:o,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95"},{children:n(s.Panel,u({className:"w-full max-w-md transform overflow-hidden rounded-2xl bg-white p-6 text-left align-middle shadow-xl transition-all"},{children:[r(s.Title,u({as:"h3",className:"text-lg font-medium leading-6 text-gray-900"},{children:"Greenmile Products Detected"})),n("div",u({className:"mt-2"},{children:[r(l,u({className:"text-sm text-gray-500"},{children:"We noticed your cart contains Greenmile products which require special handling."})),r(l,u({className:"mt-2 text-sm text-gray-500"},{children:"You can either proceed directly to checkout with these items or remove them from your cart."})),n("div",u({className:"mt-4 bg-gray-50 p-4 rounded"},{children:[r(l,u({className:"font-medium"},{children:"Greenmile items in cart:"})),r("ul",u({className:"list-disc pl-5 mt-2"},{children:N.map((function(r){var e;return n("li",u({className:"mt-1"},{children:[(null===(e=r.product)||void 0===e?void 0:e.title)||"Product"," - ",r.title]}),r.id)}))}))]}))]})),n("div",u({className:"mt-6 flex justify-end gap-3"},{children:[r(d,u({variant:"secondary",onClick:function(){return m(a,void 0,void 0,(function(){var r;return p(this,(function(n){switch(n.label){case 0:j(!0),n.label=1;case 1:return n.trys.push([1,3,,4]),z(),[4,y(g,f)];case 2:return n.sent(),document.cookie="_medusa_cart_id=;path=/;",window.location.reload(),[3,4];case 3:return r=n.sent(),console.error("Error removing Greenmile items:",r),[3,4];case 4:return j(!1),[2]}}))}))},disabled:E},{children:E?"Removing...":"Remove Items"})),r(d,u({className:"bg-green-600 hover:bg-green-700",onClick:function(){z(),window.location.href="/checkout?step=address"},disabled:E},{children:"Go to Checkout"}))]}))]}))}))}))}))]}))}))}var j=function(t){var o=t.children,a=t.retrieveCart,c=t.deleteLineItems,s=t.pathname;return i((function(){!function(){var r=this;"undefined"!=typeof window&&document.addEventListener("click",(function(n){return m(r,void 0,void 0,(function(){var r,e,t;return p(this,(function(i){switch(i.label){case 0:return("BUTTON"===(r=n.target).tagName&&r.innerText.includes("Add to cart")||r.closest('[data-testid="add-product-button"]')||r.closest('[data-testid="mobile-cart-button"]'))&&(e=document.querySelector("[data-variant-id]"))&&(t=e.getAttribute("data-variant-id"))?[4,w(t)]:[3,2];case 1:if(!i.sent())return n.preventDefault(),n.stopPropagation(),alert("This is a GreenMile product. Please use the Buy Now button for direct checkout."),[2,!1];i.label=2;case 2:return[2]}}))}))}),!0)}()}),[]),n(e,{children:[r(E,{retrieveCartFunc:a,deleteLineItems:c,pathname:s}),o]})};export{j as DirectCheckoutProvider,f as GreenMileWidget,h as ProductModal,_ as determineCartSource,x as directCheckout,C as filterVariants,b as hasGreenmileInCart,v as isGreenmileVariant,y as removeGreenmileProducts};
//# sourceMappingURL=index.esm.js.map
