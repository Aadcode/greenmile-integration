"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react/jsx-runtime"),r=require("react"),n=require("react-dom"),t=require("@headlessui/react"),i=require("@medusajs/ui");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=o(n),s=function(){return s=Object.assign||function(e){for(var r,n=1,t=arguments.length;n<t;n++)for(var i in r=arguments[n])Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i]);return e},s.apply(this,arguments)};function c(e,r,n,t){return new(n||(n=Promise))((function(i,o){function a(e){try{c(t.next(e))}catch(e){o(e)}}function s(e){try{c(t.throw(e))}catch(e){o(e)}}function c(e){var r;e.done?i(e.value):(r=e.value,r instanceof n?r:new n((function(e){e(r)}))).then(a,s)}c((t=t.apply(e,r||[])).next())}))}function l(e,r){var n,t,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(n=1,t&&(i=2&s[0]?t.return:s[0]?t.throw||((i=t.return)&&i.call(t),0):t.next)&&!(i=i.call(t,s[1])).done)return i;switch(t=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,t=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=r.call(e,o)}catch(e){s=[6,e],t=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}function d(e,r){void 0===r&&(r={});var n=r.insertAt;if(e&&"undefined"!=typeof document){var t=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&t.firstChild?t.insertBefore(i,t.firstChild):t.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}"function"==typeof SuppressedError&&SuppressedError;d("@import url('https://fonts.googleapis.com/css2?family=Jost:wght@400;500;700&display=swap');\r\n\r\n/* src/styles/ProductModal.css */\r\n.gm-modal-overlay {\r\n  display: flex;\r\n  position: fixed;\r\n  z-index: 9999999 !important;\r\n  left: 0;\r\n  top: 0;\r\n  width: 100%;\r\n  height: 100vh;\r\n  background-color: rgba(0, 0, 0, 0.6);\r\n  text-align: left;\r\n  pointer-events: auto;\r\n  align-items: center;\r\n  justify-content: center;\r\n  font-family: 'Jost', var(--font-jost), -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\r\n}\r\n\r\n.gm-modal-content {\r\n  max-width: 700px; /* Increased for wider content */\r\n  width: 100%;\r\n  margin: 0 auto;\r\n  background-color: white;\r\n  border-radius: 8px;\r\n  overflow: auto; /* Changed from hidden to auto to allow scrolling if needed */\r\n  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);\r\n  display: flex;\r\n  flex-direction: column;\r\n  max-height: 95% !important; /* Prevent modal from being taller than the viewport */\r\n  font-family: 'Jost', sans-serif !important;\r\n}\r\n\r\n/* Header */\r\n.gm-modal-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  border-bottom: 1px solid #f3f3f3;\r\n  padding: 5px 5px 0px 10px;\r\n}\r\n\r\n.gm-modal-title {\r\n  font-weight: 600 !important;\r\n  font-size: 16px !important;\r\n  margin: 0px !important;\r\n  padding: 0px !important;\r\n  margin-bottom: 5px !important;\r\n  color: #111827;\r\n}\r\n\r\n.gm-close-button {\r\n  background: none;\r\n  border: none;\r\n  color: #111827;\r\n  cursor: pointer;\r\n  padding: 4px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n/* Product Slider */\r\n.gm-product-slider {\r\n  position: relative;\r\n  height: auto;\r\n  min-height: 240px; /* Reduced from 400px */\r\n  max-height: 240px; /* Reduced from 60vh */\r\n  background-color: #ffffff;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.gm-product-image {\r\n  max-height: 30vh; /* Reduced from 55vh */\r\n  max-width: 90%; /* Reduced from 95% */\r\n  width: auto;\r\n  object-fit: contain;\r\n  display: block;\r\n}\r\n\r\n.gm-no-image {\r\n  color: #6b7280;\r\n  font-size: 14px;\r\n}\r\n\r\n.gm-slider-arrow {\r\n  position: absolute;\r\n  top: 50%;\r\n  transform: translateY(-50%);\r\n  background-color: white;\r\n  width: 30px;\r\n  height: 30px;\r\n  border-radius: 50%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\r\n  border: none;\r\n  cursor: pointer;\r\n  z-index: 1;\r\n}\r\n\r\n.gm-slider-next {\r\n  right: 10px;\r\n}\r\n\r\n.gm-slider-prev {\r\n  left: 10px;\r\n}\r\n\r\n/* Product Details */\r\n.gm-product-details {\r\n  display: flex;\r\n  flex-direction: column;\r\n  padding: 0;\r\n}\r\n\r\n.gm-product-brand {\r\n  padding: 16px 16px 0;\r\n  text-align: left;\r\n}\r\n\r\n.gm-vendor {\r\n  text-transform: uppercase;\r\n  font-weight: 700;\r\n  font-size: 14px;\r\n  letter-spacing: 0.05em;\r\n  margin: 0 0 4px;\r\n  color: #111827;\r\n  text-align: left;\r\n}\r\n\r\n.gm-product-title {\r\n  color: #111827;\r\n  margin: 0 0 16px;\r\n  font-size: 18px;\r\n  font-weight: 500;\r\n  text-align: left;\r\n  text-decoration: underline;\r\n}\r\n\r\n/* Price Section */\r\n.gm-price-section {\r\n  background-color: #f2faf5;\r\n  padding: 16px;\r\n  margin-bottom: 16px;\r\n  text-align: left;\r\n}\r\n\r\n.gm-price-row {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 5px;\r\n  text-align: left;\r\n}\r\n\r\n.gm-price-row:last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n.gm-price-label {\r\n  color: #4b5563;\r\n  font-size: 15px;\r\n  text-align: left;\r\n}\r\n\r\n.gm-price-value {\r\n  font-weight: 500;\r\n  font-size: 16px;\r\n  text-decoration: line-through;\r\n  text-align: right;\r\n}\r\n\r\n.gm-restock-label {\r\n  font-weight: 700;\r\n  font-size: 15px;\r\n  text-align: left;\r\n}\r\n\r\n.gm-restock-price {\r\n  font-weight: 700;\r\n  font-size: 20px;\r\n  color: #111827;\r\n  text-align: right;\r\n}\r\n\r\n/* Item Description */\r\n.gm-item-description {\r\n  padding: 0 16px;\r\n  margin-bottom: 16px;\r\n}\r\n\r\n.gm-description-title {\r\n  font-weight: 600;\r\n  margin: 0 0 12px;\r\n  font-size: 14px;\r\n  color: #111827;\r\n  text-align: left;\r\n}\r\n\r\n.gm-description-content {\r\n  border: 1px solid #e5e5e5;\r\n  border-radius: 4px;\r\n  padding: 16px;\r\n  text-align: left;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: flex-start;\r\n}\r\n\r\n.gm-quality-indicator {\r\n  display: flex;\r\n  align-items: center;\r\n  margin-bottom: 12px;\r\n  align-self: flex-start;\r\n  text-align: left;\r\n}\r\n\r\n.gm-quality-dot {\r\n  display: inline-block;\r\n  width: 8px;\r\n  height: 8px;\r\n  background-color: #00A827;\r\n  border-radius: 50%;\r\n  margin-right: 6px;\r\n}\r\n\r\n.gm-quality-label {\r\n  text-transform: uppercase;\r\n  font-weight: 700;\r\n  font-size: 14px;\r\n  color: #111827;\r\n  text-align: left;\r\n}\r\n\r\n.gm-remarks-title {\r\n  font-weight: 600;\r\n  margin-bottom: 8px;\r\n  font-size: 14px;\r\n  color: #111827;\r\n  text-align: left;\r\n}\r\n\r\n.gm-remarks-text {\r\n  font-size: 14px;\r\n  color: #4b5563;\r\n  margin-bottom: 0;\r\n  line-height: 1.5;\r\n  text-align: left;\r\n}\r\n\r\n/* CTA Button */\r\n.gm-cta-container {\r\n  padding: 0 16px 16px;\r\n  margin-top: auto;\r\n}\r\n\r\n.gm-cta-button {\r\n  background-color: #00A827;\r\n  color: white;\r\n  text-align: center;\r\n  font-weight: 700;\r\n  padding: 14px;\r\n  width: 100%;\r\n  border: none;\r\n  cursor: pointer;\r\n  border-radius: 4px;\r\n  text-transform: uppercase;\r\n  letter-spacing: 0.025em;\r\n  font-size: 14px;\r\n}\r\n\r\n.gm-final-sale {\r\n  text-align: center;\r\n  font-size: 12px;\r\n  color: #6b7280;\r\n  margin-top: 8px;\r\n}\r\n\r\n/* Responsive Design */\r\n@media (max-width: 480px) {\r\n  .gm-modal-content {\r\n    max-width: 95%;\r\n    height: auto;\r\n    max-height: 100%;\r\n  }\r\n  \r\n  .gm-product-slider {\r\n    min-height: 200px; /* Reduced from 300px */\r\n    max-height: 35vh; /* Reduced from 70vh */\r\n  }\r\n  \r\n  .gm-product-image {\r\n    max-height: 25vh; /* Reduced from 65vh */\r\n    max-width: 90%;\r\n    width: auto;\r\n  }\r\n}\r\n");var u=function(n){var t=n.productInfo,i=n.productTitle,o=n.productVendor,c=void 0===o?"":o,l=n.currency,d=void 0===l?"USD":l,u=n.onClose,p=n.onCheckout;n.apiClient;var m=r.useState(""),g=m[0],f=m[1],h=r.useState(!1);h[0],h[1];var x=r.useState(0),v=x[0],y=x[1],b=r.useState([]),w=b[0],j=b[1],k=r.useState(""),N=k[0],C=k[1],E=r.useState(""),S=E[0],_=E[1],T=r.useState(null),P=T[0],F=T[1];r.useEffect((function(){if("undefined"!=typeof window){var e=document.getElementById("greenmile-modal-root");return e||((e=document.createElement("div")).id="greenmile-modal-root",document.body.appendChild(e)),F(e),function(){e&&0===e.childElementCount&&document.body.removeChild(e)}}}),[]),r.useEffect((function(){if(t)if(t.urgency_price&&Object.keys(t.urgency_price).length>0){var e=Object.keys(t.urgency_price);f(e[0])}else if(f("like new"),t.discounted_price)_("string"==typeof t.discounted_price?t.discounted_price:z(t.discounted_price));else if(t.original_price){var r="number"==typeof t.original_price?.85*t.original_price:.85*parseFloat(t.original_price);_(z(r))}}),[t]),r.useEffect((function(){var e,r;if(g&&t){var n=void 0;t.urgency_price&&t.urgency_price[g]?n=t.urgency_price[g]:t.discounted_price?n=t.discounted_price:t.original_price&&(n="number"==typeof t.original_price?.85*t.original_price:.85*parseFloat(t.original_price)),"string"==typeof n&&n.startsWith("$")?_(n):void 0!==n&&_(z(n)),C((null===(e=t.inspection)||void 0===e?void 0:e[g])||"This item was previously purchased and returned in perfect condition. It has been thoroughly inspected and certified by our quality team.");var i=(null===(r=t.images)||void 0===r?void 0:r[g])||[];i.length?j(i):j(["https://placehold.co/300x300?text=No+Image"]),y(0)}}),[g,t]);var z=function(e){var r="string"==typeof e?parseFloat(e):e;return new Intl.NumberFormat("en",{style:"currency",currency:d,currencyDisplay:"narrowSymbol"}).format(r)};return r.useEffect((function(){if("undefined"!=typeof window){var e=function(e){"Escape"===e.key&&u()};return window.addEventListener("keydown",e),function(){return window.removeEventListener("keydown",e)}}}),[u]),P?a.default.createPortal(e.jsx("div",s({className:"gm-modal-overlay",onClick:u},{children:e.jsxs("div",s({className:"gm-modal-content",onClick:function(e){return e.stopPropagation()}},{children:[e.jsxs("div",s({className:"gm-modal-header"},{children:[e.jsx("h3",s({className:"gm-modal-title"},{children:"Like-New Return Available"})),e.jsx("button",s({className:"gm-close-button",onClick:u},{children:e.jsxs("svg",s({xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},{children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}))}))]})),e.jsxs("div",s({className:"gm-product-slider"},{children:[w.length>0?e.jsx("img",{src:w[v],alt:"".concat(i," - image ").concat(v+1),className:"gm-product-image"}):e.jsx("div",s({className:"gm-no-image"},{children:"No image available"})),w.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",s({className:"gm-slider-arrow gm-slider-prev",onClick:function(){y((function(e){return Math.max(0,e-1)}))},disabled:0===v},{children:e.jsx("svg",s({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},{children:e.jsx("polyline",{points:"15 18 9 12 15 6"})}))})),e.jsx("button",s({className:"gm-slider-arrow gm-slider-next",onClick:function(){y((function(e){return Math.min(w.length-1,e+1)}))},disabled:v===w.length-1},{children:e.jsx("svg",s({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},{children:e.jsx("polyline",{points:"9 18 15 12 9 6"})}))}))]})]})),e.jsxs("div",s({className:"gm-product-details"},{children:[e.jsxs("div",s({className:"gm-product-brand"},{children:[c&&e.jsx("h4",s({className:"gm-vendor"},{children:c.toUpperCase()})),e.jsx("h2",s({className:"gm-product-title"},{children:i}))]})),e.jsxs("div",s({className:"gm-price-section"},{children:[e.jsxs("div",s({className:"gm-price-row"},{children:[e.jsx("div",s({className:"gm-price-label"},{children:"Original Price"})),e.jsx("div",s({className:"gm-price-value"},{children:(null==t?void 0:t.price)||z((null==t?void 0:t.original_price)||0)}))]})),e.jsxs("div",s({className:"gm-price-row"},{children:[e.jsx("div",s({className:"gm-restock-label"},{children:"Restock Price"})),e.jsx("div",s({className:"gm-restock-price"},{children:(null==t?void 0:t.discounted_price)||S}))]}))]})),e.jsxs("div",s({className:"gm-item-description"},{children:[e.jsx("h5",s({className:"gm-description-title"},{children:"Item Description"})),e.jsxs("div",s({className:"gm-description-content"},{children:[e.jsxs("div",s({className:"gm-quality-indicator"},{children:[e.jsx("span",{className:"gm-quality-dot"}),e.jsx("span",s({className:"gm-quality-label"},{children:(null==g?void 0:g.toUpperCase())||"LIKE NEW"}))]})),e.jsx("div",s({className:"gm-remarks-title"},{children:"Tags and packaging intact."})),e.jsx("p",s({className:"gm-remarks-text"},{children:N||"This item was previously purchased and returned in perfect condition. It has been thoroughly inspected and certified by our quality team, allowing us to offer it at a reduced price."}))]}))]})),e.jsxs("div",s({className:"gm-cta-container"},{children:[e.jsxs("button",s({className:"gm-cta-button",onClick:p},{children:["GET THIS DEAL Â· ",S]})),e.jsx("div",s({className:"gm-final-sale"},{children:"Final sale, no returns."}))]}))]}))]}))})),P):null};d("/* src/styles/GreenMileWidget.css */\r\n@import url('https://fonts.googleapis.com/css2?family=Jost:ital,wght@0,100..900;1,100..900&display=swap');\r\n\r\n.gm-widget {\r\n  max-width: 480px;\r\n  width: 100%;\r\n  font-family: 'Jost', sans-serif;\r\n  margin: 15px 0;\r\n}\r\n\r\n.deal-card {\r\n  border: 1px solid #e5e5e5;\r\n  border-radius: 4px;\r\n  background-color: white;\r\n  overflow: hidden;\r\n}\r\n\r\n/* Header Section */\r\n.gm-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding: 12px 16px;\r\n  border-bottom: 1px solid #e5e5e5;\r\n}\r\n\r\n.green-text {\r\n  color: #2ca02c;\r\n  font-weight: 500;\r\n}\r\n\r\n.gm-powered-by {\r\n  display: flex;\r\n  align-items: center;\r\n  font-size: 12px;\r\n  color: #6b7280;\r\n}\r\n\r\n.gm-logo {\r\n  margin-left: 4px;\r\n  width: 16px;\r\n  height: 16px;\r\n}\r\n\r\n/* Content Section */\r\n.gm-content {\r\n  padding: 16px;\r\n  padding-bottom: 8px;\r\n}\r\n\r\n/* Buy Button */\r\n.gm-buy-button {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  width: 100%;\r\n  padding: 12px 16px;\r\n  background-color: #2ca02c;\r\n  color: white;\r\n  font-weight: bold;\r\n  border: none;\r\n  border-radius: 4px;\r\n  cursor: pointer;\r\n  font-family: inherit;\r\n  margin-bottom: 8px;\r\n}\r\n\r\n.gm-button-text {\r\n  font-weight: 700;\r\n  font-size: 14px;\r\n  letter-spacing: 0.1em;\r\n  text-transform: uppercase;\r\n}\r\n\r\n.gm-price-container {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.gm-original-price {\r\n  font-size: 14px;\r\n  text-decoration: line-through;\r\n  opacity: 0.8;\r\n  margin-right: 8px;\r\n  color: white;\r\n}\r\n\r\n.gm-discount-price {\r\n  font-size: 18px;\r\n  font-weight: 700;\r\n  color: white;\r\n}\r\n\r\n/* Features Section */\r\n.gm-features {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  gap: 24px;\r\n  padding: 8px 0 16px;\r\n}\r\n\r\n.gm-feature-item {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.check-icon {\r\n  position: relative;\r\n  padding-left: 22px;\r\n  font-size: 12px;\r\n  color: #4b5563;\r\n}\r\n\r\n.check-icon::before {\r\n  content: \"\";\r\n  display: inline-block;\r\n  width: 16px;\r\n  height: 16px;\r\n  background: url('https://i.ibb.co/hFt9sX2x/material-symbols-check-rounded.png') no-repeat;\r\n  background-size: contain;\r\n  position: absolute;\r\n  left: 0;\r\n  top: 50%;\r\n  transform: translateY(-50%);\r\n}\r\n\r\n/* Loading State */\r\n.gm-loading {\r\n  text-align: center;\r\n  padding: 16px;\r\n  color: #6b7280;\r\n}\r\n\r\n/* Modal styles */\r\n.gm-modal-overlay {\r\n  display: flex;\r\n  position: fixed;\r\n  z-index: 9999999 !important;\r\n  left: 0;\r\n  top: 0;\r\n  width: 100%;\r\n  height: 100vh;\r\n  background-color: rgba(0, 0, 0, 0.4);\r\n  text-align: center;\r\n  pointer-events: auto;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.gm-modal-content {\r\n  background-color: white;\r\n  margin: auto;\r\n  padding: 12px;\r\n  border-radius: 8px;\r\n  max-width: 90vw;\r\n  width: 400px;\r\n  max-height: 90vh;\r\n  z-index: 9999999;\r\n  overflow-y: auto;\r\n  height: auto;\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: space-between;\r\n  position: relative;\r\n  padding-bottom: 20px;\r\n}\r\n\r\n.gm-modal-title {\r\n  font-weight: bold;\r\n  font-size: 18px;\r\n  text-align: left;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.gm-close-button {\r\n  position: absolute;\r\n  top: 8px;\r\n  right: 8px;\r\n  color: black;\r\n  background-color: transparent;\r\n  font-size: 17px;\r\n  font-weight: bold;\r\n  cursor: pointer;\r\n  width: 28px;\r\n  height: 28px;\r\n  border-radius: 50%;\r\n  display: flex;\r\n  line-height: 0;\r\n  align-items: center;\r\n  justify-content: center;\r\n  transition: background-color 0.3s ease, color 0.3s ease;\r\n}\r\n\r\n.gm-close-button:hover {\r\n  background-color: #2ca02c;\r\n  color: white;\r\n}\r\n\r\n.gm-delivery-info {\r\n  font-size: 12px;\r\n  color: #555;\r\n  font-weight: bold;\r\n  margin: 5px 0 0 0;\r\n}\r\n");function p(e){return!(!e||!e.title)&&e.title.toLowerCase().includes("greenmile")}var m=function(e,r){return c(void 0,void 0,void 0,(function(){var n,t,i,o,a,s,d,u;return l(this,(function(p){switch(p.label){case 0:return p.trys.push([0,4,,5]),[4,e()];case 1:return(n=p.sent())&&n.id&&Array.isArray(n.items)?(t=function(e){var r;return"greenmile"===(null===(r=null==e?void 0:e.split("-")[0])||void 0===r?void 0:r.trim().toLowerCase())},i=n.items,0===(o=i.filter((function(e){return t(e.title)}))).length?[2,{success:!0,isEmpty:0===i.length}]:(a=function(e,r){return void 0===r&&(r=2),c(void 0,void 0,void 0,(function(){var n,t,i;return l(this,(function(o){switch(o.label){case 0:n=function(n){var t;return l(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,4]),[4,e()];case 1:return i.sent(),[2,{value:void 0}];case 2:if(t=i.sent(),n===r)throw t;return[4,new Promise((function(e){return setTimeout(e,300*(n+1))}))];case 3:return i.sent(),[3,4];case 4:return[2]}}))},t=0,o.label=1;case 1:return t<=r?[5,n(t)]:[3,4];case 2:if("object"==typeof(i=o.sent()))return[2,i.value];o.label=3;case 3:return t++,[3,1];case 4:return[2]}}))}))},s=o.map((function(e){return a((function(){return r(e.id)}))})),[4,Promise.all(s)])):(console.error("Cart not found or invalid"),[2,{success:!1,isEmpty:!0}]);case 2:return p.sent(),[4,e()];case 3:return d=p.sent(),[2,{success:!0,isEmpty:!d||0===d.items.length}];case 4:return u=p.sent(),console.error("Failed to remove Greenmile products:",u),[2,{success:!1,isEmpty:!1}];case 5:return[2]}}))}))};function g(e){return c(this,void 0,void 0,(function(){var r,n,t,i;return l(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,fetch("/store/variants/".concat(e))];case 1:return(r=o.sent()).ok?[4,r.json()]:(console.error("Failed to fetch variant for cart validation:",r.status),[2,!0]);case 2:return n=o.sent(),p(t=n.variant)?(console.warn("Prevented adding Greenmile variant to cart:",t.title),[2,!1]):[2,!0];case 3:return i=o.sent(),console.error("Error in cart validation:",i),[2,!0];case 4:return[2]}}))}))}var f={excludePrefixes:[],customFilter:void 0};function h(e,r){if(!e||!r||0===r.length)return!1;var n=e.toLowerCase();return r.some((function(e){return n.startsWith(e.toLowerCase())}))}function x(n){var o=this,a=n.retrieveCartFunc,d=n.pathname,u=n.deleteLineItems,g=r.useState(!1),f=g[0],h=g[1],x=r.useState([]),v=x[0],y=x[1],b=r.useState(!1),w=b[0],j=b[1];r.useEffect((function(){if(!d.includes("/checkout")){c(o,void 0,void 0,(function(){var e,r,n;return l(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,a()];case 1:return(e=t.sent())&&e.items?((r=e.items.filter((function(e){return p(e.variant)})).map((function(e){return e.variant}))).length>0&&(y(r),h(!0)),[3,3]):[2];case 2:return n=t.sent(),console.error("Error checking cart for Greenmile variants:",n),[3,3];case 3:return[2]}}))}))}}),[d]);var k=function(){h(!1)};return 0===v.length?null:e.jsx(t.Transition,s({appear:!0,show:f,as:r.Fragment},{children:e.jsxs(t.Dialog,s({as:"div",className:"relative z-50",onClose:k},{children:[e.jsx(t.Transition.Child,s({as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0"},{children:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm"})})),e.jsx("div",s({className:"fixed inset-0 overflow-y-auto"},{children:e.jsx("div",s({className:"flex min-h-full items-center justify-center p-4 text-center"},{children:e.jsx(t.Transition.Child,s({as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95"},{children:e.jsxs(t.Dialog.Panel,s({className:"w-full max-w-md transform overflow-hidden rounded-2xl bg-white p-6 text-left align-middle shadow-xl transition-all"},{children:[e.jsx(t.Dialog.Title,s({as:"h3",className:"text-lg font-medium leading-6 text-gray-900"},{children:"Greenmile Products Detected"})),e.jsxs("div",s({className:"mt-2"},{children:[e.jsx(i.Text,s({className:"text-sm text-gray-500"},{children:"We noticed your cart contains Greenmile products which require special handling."})),e.jsx(i.Text,s({className:"mt-2 text-sm text-gray-500"},{children:"You can either proceed directly to checkout with these items or remove them from your cart."})),e.jsxs("div",s({className:"mt-4 bg-gray-50 p-4 rounded"},{children:[e.jsx(i.Text,s({className:"font-medium"},{children:"Greenmile items in cart:"})),e.jsx("ul",s({className:"list-disc pl-5 mt-2"},{children:v.map((function(r){var n;return e.jsxs("li",s({className:"mt-1"},{children:[(null===(n=r.product)||void 0===n?void 0:n.title)||"Product"," - ",r.title]}),r.id)}))}))]}))]})),e.jsxs("div",s({className:"mt-6 flex justify-end gap-3"},{children:[e.jsx(i.Button,s({variant:"secondary",onClick:function(){return c(o,void 0,void 0,(function(){var e;return l(this,(function(r){switch(r.label){case 0:j(!0),r.label=1;case 1:return r.trys.push([1,3,,4]),k(),[4,m(a,u)];case 2:return r.sent(),document.cookie="_medusa_cart_id=;path=/;",window.location.reload(),[3,4];case 3:return e=r.sent(),console.error("Error removing Greenmile items:",e),[3,4];case 4:return j(!1),[2]}}))}))},disabled:w},{children:w?"Removing...":"Remove Items"})),e.jsx(i.Button,s({className:"bg-green-600 hover:bg-green-700",onClick:function(){k(),window.location.href="/checkout?step=address"},disabled:w},{children:"Go to Checkout"}))]}))]}))}))}))}))]}))}))}exports.DirectCheckoutProvider=function(n){var t=n.children,i=n.retrieveCart,o=n.deleteLineItems,a=n.pathname;return r.useEffect((function(){!function(){var e=this;"undefined"!=typeof window&&document.addEventListener("click",(function(r){return c(e,void 0,void 0,(function(){var e,n,t;return l(this,(function(i){switch(i.label){case 0:return("BUTTON"===(e=r.target).tagName&&e.innerText.includes("Add to cart")||e.closest('[data-testid="add-product-button"]')||e.closest('[data-testid="mobile-cart-button"]'))&&(n=document.querySelector("[data-variant-id]"))&&(t=n.getAttribute("data-variant-id"))?[4,g(t)]:[3,2];case 1:if(!i.sent())return r.preventDefault(),r.stopPropagation(),alert("This is a GreenMile product. Please use the Buy Now button for direct checkout."),[2,!1];i.label=2;case 2:return[2]}}))}))}),!0)}()}),[]),e.jsxs(e.Fragment,{children:[e.jsx(x,{retrieveCartFunc:i,deleteLineItems:o,pathname:a}),t]})},exports.GreenMileWidget=function(n){var t=n.productId,i=n.productTitle,o=n.productVendor,a=void 0===o?"":o,d=n.productPrice,p=n.discountedPrice,m=n.variantId,g=n.handleCheckout,f=n.currency,h=void 0===f?"USD":f,x=n.backendUrl,v=n.storeUrl,y=n.apiClient,b=n.onCheckout,w=r.useState(!1),j=w[0],k=w[1],N=r.useState(null),C=N[0],E=N[1],S=r.useState(!0),_=S[0],T=S[1],P=r.useState(null),F=P[0],z=P[1];r.useEffect((function(){c(void 0,void 0,void 0,(function(){var e,r,n,i,o,a;return l(this,(function(s){switch(s.label){case 0:return s.trys.push([0,5,6,7]),T(!0),[4,fetch("https://ipinfo.io/json?token=0938f3aebe35e7")];case 1:case 3:return[4,s.sent().json()];case 2:return e=s.sent(),r=e.loc.split(","),n=r[0],i=r[1],[4,fetch("".concat(x,"/medusa/product-info/"),{method:"POST",headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"69420"},body:JSON.stringify({shop:v,product_price:d,product_id:t,variant_id:m,variant:"Default",location:{latitude:n,longitude:i}})})];case 4:return o=s.sent(),E(o),[3,7];case 5:return a=s.sent(),console.error("Error fetching product info:",a),z("Unable to load product information"),[3,7];case 6:return T(!1),[7];case 7:return[2]}}))}))}),[t,m,d,x,v]);if(_)return e.jsx("div",s({className:"gm-loading"},{children:"Loading product information..."}));if(F||!C)return console.error("Error or no product info:",F),null;var I=C.price,L=C.discounted_price,G=function(e){if(null==e)return"";if("string"==typeof e&&e.startsWith("$"))return e;var r="string"==typeof e?parseFloat(e):e;return isNaN(r)?"":new Intl.NumberFormat("en",{style:"currency",currency:h,currencyDisplay:"narrowSymbol"}).format(r)};return e.jsxs("div",s({className:"gm-widget"},{children:[e.jsxs("div",s({className:"deal-card"},{children:[e.jsxs("div",s({className:"gm-header"},{children:[e.jsx("div",s({className:"green-text"},{children:"Like-New Return Available"})),e.jsxs("div",s({className:"gm-powered-by"},{children:["Powered by GreenMile",e.jsx("img",{src:"https://i.ibb.co/Rkr0W5dx/Green-Mile-Symbol.png",alt:"GreenMile",width:16,height:16,className:"gm-logo"})]}))]})),e.jsxs("div",s({className:"gm-content"},{children:[e.jsxs("button",s({className:"gm-buy-button",onClick:function(){return k(!0)}},{children:[e.jsx("span",s({className:"gm-button-text"},{children:"GET THIS DEAL"})),e.jsxs("div",s({className:"gm-price-container"},{children:[e.jsx("span",s({className:"gm-original-price"},{children:I||G(d)})),e.jsx("span",s({className:"gm-discount-price"},{children:L||G(p)}))]}))]})),e.jsxs("div",s({className:"gm-features"},{children:[e.jsx("div",s({className:"gm-feature-item"},{children:e.jsx("span",s({className:"check-icon"},{children:"Like-New Condition"}))})),e.jsx("div",s({className:"gm-feature-item"},{children:e.jsx("span",s({className:"check-icon"},{children:"Quality Checked"}))})),e.jsx("div",s({className:"gm-feature-item"},{children:e.jsx("span",s({className:"check-icon"},{children:"Fast Shipping"}))}))]}))]}))]})),"      ","      ",j&&e.jsx(u,{productInfo:C,productTitle:i,productVendor:a,currency:h,onClose:function(){return k(!1)},onCheckout:function(){return c(void 0,void 0,void 0,(function(){var e,r;return l(this,(function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),(null==C?void 0:C.returned_variant)?(e="undefined"!=typeof window&&window.location.pathname.split("/")[1]||"dk","function"!=typeof b?[3,1]:(b(C.returned_variant,C.discount_code||""),[3,3])):[3,3];case 1:return[4,g(C.returned_variant,1,e)];case 2:n.sent(),n.label=3;case 3:return[3,5];case 4:return r=n.sent(),console.error("Checkout failed:",r),[3,5];case 5:return[2]}}))}))},apiClient:y})]}))},exports.ProductModal=u,exports.determineCartSource=function(e){var r=e.retrieveCartFunc;return c(this,void 0,void 0,(function(){var e,n;return l(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,r()];case 1:return(e=t.sent())&&e.items&&0!==e.items.length&&e.items[0].title&&"greenmile"===e.items[0].title.split("-")[0].toLowerCase()?[2,"greenmile"]:[2,"medusa"];case 2:return n=t.sent(),console.error("Error determining cart source:",n),[2,"medusa"];case 3:return[2]}}))}))},exports.directCheckout=function(e,r,n,t){var i;return void 0===r&&(r=1),c(this,void 0,void 0,(function(){var o,a,s,c,d,u,p,m,g,f,h,x;return l(this,(function(l){switch(l.label){case 0:if(l.trys.push([0,11,,12]),console.log("Starting direct checkout with variant: ".concat(e,", quantity: ").concat(r,", country: ").concat(n)),o=void 0,t)o=t;else{if("undefined"==typeof window||!window.sdk)throw new Error("Medusa SDK not available");o=window.sdk}return[4,o.client.fetch("/store/regions",{method:"GET"})];case 1:if(a=l.sent(),console.log("Retrieved regions:",a.regions),!(null==(s=null===(i=a.regions)||void 0===i?void 0:i.find((function(e){var r;return null===(r=e.countries)||void 0===r?void 0:r.some((function(e){return e.iso_2===n.toLowerCase()}))})))?void 0:s.id))throw console.error("Region not found for country code: ".concat(n)),new Error("Region not found for country code: ".concat(n));console.log("Found region: ".concat(s.id," for country: ").concat(n)),c=void 0,l.label=2;case 2:return l.trys.push([2,4,,5]),[4,o.store.cart.create({region_id:s.id})];case 3:return c=l.sent(),[3,5];case 4:throw d=l.sent(),console.error("Error creating cart:",d),d;case 5:u=c.cart.id,console.log("Created cart: ".concat(u)),p=void 0,l.label=6;case 6:return l.trys.push([6,9,,10]),[4,o.store.cart.createLineItem(u,{variant_id:e,quantity:r})];case 7:return p=l.sent(),console.log("Added line item to cart:",p),[4,o.store.cart.retrieve(u)];case 8:if(m=l.sent(),console.log("Cart after adding item:",m),!m.cart.items||0===m.cart.items.length)throw console.error("No items found in cart after adding line item."),new Error("Failed to add item to cart");return[3,10];case 9:throw g=l.sent(),console.error("Error adding item to cart:",g),g;case 10:return"undefined"==typeof document?(console.log("Cart created with ID ".concat(u,", but not in browser environment to set cookie and redirect")),[2]):(document.cookie="_greenmile_cart_id=".concat(u),f=window.location.origin,h="".concat(f,"/").concat(n,"/checkout?step=address"),console.log("Redirecting to: ".concat(h)),window.location.href=h,[3,12]);case 11:throw x=l.sent(),console.error("Direct checkout failed:",x),x;case 12:return[2]}}))}))},exports.filterVariants=function(e,r){void 0===r&&(r=f);var n=s(s({},f),r);if(!e)return e;var t=e.variants?e.variants.filter((function(e){return!e.title||!(n.excludePrefixes&&n.excludePrefixes.length>0&&h(e.title,n.excludePrefixes))&&(!n.customFilter||n.customFilter(e))})):[],i=e.options?function(e,r){return e&&0!==e.length&&r&&0!==r.length?e.map((function(e){return s(s({},e),{values:e.values?e.values.filter((function(e){var n;return!h(null!==(n=e.value)&&void 0!==n?n:"",r)})):[]})})):e}(e.options,n.excludePrefixes||[]):[];return s(s({},e),{variants:t,options:i})},exports.hasGreenmileInCart=function(e){return c(void 0,void 0,void 0,(function(){var r,n,t;return l(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,e()];case 1:return r=i.sent(),(null===(t=null==r?void 0:r.items)||void 0===t?void 0:t.length)?[2,r.items.some((function(e){return!!e.variant&&p(e.variant)}))]:[2,!1];case 2:return n=i.sent(),console.error("Error checking for Greenmile variants in cart:",n),[2,!1];case 3:return[2]}}))}))},exports.isGreenmileVariant=p,exports.removeGreenmileProducts=m;
//# sourceMappingURL=index.js.map
