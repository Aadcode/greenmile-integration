{"version":3,"file":"index.esm.js","sources":["../node_modules/tslib/tslib.es6.mjs","../node_modules/style-inject/dist/style-inject.es.js","../src/components/ProductModal.tsx","../src/components/GreenMileWidget.tsx","../src/utils/directCheckout.ts","../src/utils/cart-interceptor.ts","../src/utils/variantFilter.ts","../src/utils/determineCartSource.ts","../src/components/cart-validator.tsx","../src/components/direct-checkout-provider.tsx"],"sourcesContent":["/******************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\n\nvar extendStatics = function(d, b) {\n  extendStatics = Object.setPrototypeOf ||\n      ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n      function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n  return extendStatics(d, b);\n};\n\nexport function __extends(d, b) {\n  if (typeof b !== \"function\" && b !== null)\n      throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n  extendStatics(d, b);\n  function __() { this.constructor = d; }\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nexport var __assign = function() {\n  __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n      return t;\n  }\n  return __assign.apply(this, arguments);\n}\n\nexport function __rest(s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n      t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n      for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n              t[p[i]] = s[p[i]];\n      }\n  return t;\n}\n\nexport function __decorate(decorators, target, key, desc) {\n  var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n  else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n}\n\nexport function __param(paramIndex, decorator) {\n  return function (target, key) { decorator(target, key, paramIndex); }\n}\n\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n  function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\n  var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\n  var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\n  var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n  var _, done = false;\n  for (var i = decorators.length - 1; i >= 0; i--) {\n      var context = {};\n      for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\n      for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n      context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\n      var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\n      if (kind === \"accessor\") {\n          if (result === void 0) continue;\n          if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\n          if (_ = accept(result.get)) descriptor.get = _;\n          if (_ = accept(result.set)) descriptor.set = _;\n          if (_ = accept(result.init)) initializers.unshift(_);\n      }\n      else if (_ = accept(result)) {\n          if (kind === \"field\") initializers.unshift(_);\n          else descriptor[key] = _;\n      }\n  }\n  if (target) Object.defineProperty(target, contextIn.name, descriptor);\n  done = true;\n};\n\nexport function __runInitializers(thisArg, initializers, value) {\n  var useValue = arguments.length > 2;\n  for (var i = 0; i < initializers.length; i++) {\n      value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n  }\n  return useValue ? value : void 0;\n};\n\nexport function __propKey(x) {\n  return typeof x === \"symbol\" ? x : \"\".concat(x);\n};\n\nexport function __setFunctionName(f, name, prefix) {\n  if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\n  return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\n};\n\nexport function __metadata(metadataKey, metadataValue) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\n}\n\nexport function __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n  return new (P || (P = Promise))(function (resolve, reject) {\n      function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n      function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n      function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n      step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nexport function __generator(thisArg, body) {\n  var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\n  return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n  function verb(n) { return function (v) { return step([n, v]); }; }\n  function step(op) {\n      if (f) throw new TypeError(\"Generator is already executing.\");\n      while (g && (g = 0, op[0] && (_ = 0)), _) try {\n          if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n          if (y = 0, t) op = [op[0] & 2, t.value];\n          switch (op[0]) {\n              case 0: case 1: t = op; break;\n              case 4: _.label++; return { value: op[1], done: false };\n              case 5: _.label++; y = op[1]; op = [0]; continue;\n              case 7: op = _.ops.pop(); _.trys.pop(); continue;\n              default:\n                  if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                  if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                  if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                  if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                  if (t[2]) _.ops.pop();\n                  _.trys.pop(); continue;\n          }\n          op = body.call(thisArg, _);\n      } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n      if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n  }\n}\n\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n  }\n  Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nexport function __exportStar(m, o) {\n  for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\n}\n\nexport function __values(o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n      next: function () {\n          if (o && i >= o.length) o = void 0;\n          return { value: o && o[i++], done: !o };\n      }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n}\n\nexport function __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o), r, ar = [], e;\n  try {\n      while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  }\n  catch (error) { e = { error: error }; }\n  finally {\n      try {\n          if (r && !r.done && (m = i[\"return\"])) m.call(i);\n      }\n      finally { if (e) throw e.error; }\n  }\n  return ar;\n}\n\n/** @deprecated */\nexport function __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++)\n      ar = ar.concat(__read(arguments[i]));\n  return ar;\n}\n\n/** @deprecated */\nexport function __spreadArrays() {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n  for (var r = Array(s), k = 0, i = 0; i < il; i++)\n      for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n  return r;\n}\n\nexport function __spreadArray(to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n      if (ar || !(i in from)) {\n          if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n          ar[i] = from[i];\n      }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n}\n\nexport function __await(v) {\n  return this instanceof __await ? (this.v = v, this) : new __await(v);\n}\n\nexport function __asyncGenerator(thisArg, _arguments, generator) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var g = generator.apply(thisArg, _arguments || []), i, q = [];\n  return i = Object.create((typeof AsyncIterator === \"function\" ? AsyncIterator : Object).prototype), verb(\"next\"), verb(\"throw\"), verb(\"return\", awaitReturn), i[Symbol.asyncIterator] = function () { return this; }, i;\n  function awaitReturn(f) { return function (v) { return Promise.resolve(v).then(f, reject); }; }\n  function verb(n, f) { if (g[n]) { i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; if (f) i[n] = f(i[n]); } }\n  function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\n  function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\n  function fulfill(value) { resume(\"next\", value); }\n  function reject(value) { resume(\"throw\", value); }\n  function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\n}\n\nexport function __asyncDelegator(o) {\n  var i, p;\n  return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\n  function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\n}\n\nexport function __asyncValues(o) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var m = o[Symbol.asyncIterator], i;\n  return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\n  function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\n  function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\n}\n\nexport function __makeTemplateObject(cooked, raw) {\n  if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\n  return cooked;\n};\n\nvar __setModuleDefault = Object.create ? (function(o, v) {\n  Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n  o[\"default\"] = v;\n};\n\nvar ownKeys = function(o) {\n  ownKeys = Object.getOwnPropertyNames || function (o) {\n    var ar = [];\n    for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\n    return ar;\n  };\n  return ownKeys(o);\n};\n\nexport function __importStar(mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\n  __setModuleDefault(result, mod);\n  return result;\n}\n\nexport function __importDefault(mod) {\n  return (mod && mod.__esModule) ? mod : { default: mod };\n}\n\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n}\n\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n}\n\nexport function __classPrivateFieldIn(state, receiver) {\n  if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\n  return typeof state === \"function\" ? receiver === state : state.has(receiver);\n}\n\nexport function __addDisposableResource(env, value, async) {\n  if (value !== null && value !== void 0) {\n    if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\n    var dispose, inner;\n    if (async) {\n      if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\n      dispose = value[Symbol.asyncDispose];\n    }\n    if (dispose === void 0) {\n      if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\n      dispose = value[Symbol.dispose];\n      if (async) inner = dispose;\n    }\n    if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\n    if (inner) dispose = function() { try { inner.call(this); } catch (e) { return Promise.reject(e); } };\n    env.stack.push({ value: value, dispose: dispose, async: async });\n  }\n  else if (async) {\n    env.stack.push({ async: true });\n  }\n  return value;\n}\n\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n  var e = new Error(message);\n  return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\nexport function __disposeResources(env) {\n  function fail(e) {\n    env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\n    env.hasError = true;\n  }\n  var r, s = 0;\n  function next() {\n    while (r = env.stack.pop()) {\n      try {\n        if (!r.async && s === 1) return s = 0, env.stack.push(r), Promise.resolve().then(next);\n        if (r.dispose) {\n          var result = r.dispose.call(r.value);\n          if (r.async) return s |= 2, Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\n        }\n        else s |= 1;\n      }\n      catch (e) {\n        fail(e);\n      }\n    }\n    if (s === 1) return env.hasError ? Promise.reject(env.error) : Promise.resolve();\n    if (env.hasError) throw env.error;\n  }\n  return next();\n}\n\nexport function __rewriteRelativeImportExtension(path, preserveJsx) {\n  if (typeof path === \"string\" && /^\\.\\.?\\//.test(path)) {\n      return path.replace(/\\.(tsx)$|((?:\\.d)?)((?:\\.[^./]+?)?)\\.([cm]?)ts$/i, function (m, tsx, d, ext, cm) {\n          return tsx ? preserveJsx ? \".jsx\" : \".js\" : d && (!ext || !cm) ? m : (d + ext + \".\" + cm.toLowerCase() + \"js\");\n      });\n  }\n  return path;\n}\n\nexport default {\n  __extends,\n  __assign,\n  __rest,\n  __decorate,\n  __param,\n  __esDecorate,\n  __runInitializers,\n  __propKey,\n  __setFunctionName,\n  __metadata,\n  __awaiter,\n  __generator,\n  __createBinding,\n  __exportStar,\n  __values,\n  __read,\n  __spread,\n  __spreadArrays,\n  __spreadArray,\n  __await,\n  __asyncGenerator,\n  __asyncDelegator,\n  __asyncValues,\n  __makeTemplateObject,\n  __importStar,\n  __importDefault,\n  __classPrivateFieldGet,\n  __classPrivateFieldSet,\n  __classPrivateFieldIn,\n  __addDisposableResource,\n  __disposeResources,\n  __rewriteRelativeImportExtension,\n};\n","function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","// src/components/ProductModal.tsx\r\nimport React, { useState, useEffect } from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport '../styles/ProductModal.css';\r\n\r\ninterface ProductModalProps {\r\n  productInfo: any;\r\n  productTitle: string;\r\n  productVendor?: string;\r\n  currency?: string;\r\n  onClose: () => void;\r\n  onCheckout: () => void;\r\n  apiClient?: any;\r\n}\r\n\r\nconst ProductModal: React.FC<ProductModalProps> = ({\r\n  productInfo,\r\n  productTitle,\r\n  productVendor = '',\r\n  currency = 'USD',\r\n  onClose,\r\n  onCheckout,\r\n  apiClient\r\n})=> {\r\n  const [selectedQuality, setSelectedQuality] = useState('');\r\n  const [showDropdown, setShowDropdown] = useState(false);\r\n  const [currentImageIndex, setCurrentImageIndex] = useState(0);\r\n  const [images, setImages] = useState<string[]>([]);\r\n  const [currentRemarks, setCurrentRemarks] = useState('');\r\n  const [currentPrice, setCurrentPrice] = useState('');\r\n  const [portalRoot, setPortalRoot] = useState<HTMLElement | null>(null);\r\n  \r\n  // Set up portal root and clean up\r\n  useEffect(() => {\r\n    if (typeof window === 'undefined') return; // Check for browser environment\r\n    \r\n    let root = document.getElementById('greenmile-modal-root');\r\n    if (!root) {\r\n      root = document.createElement('div');\r\n      root.id = 'greenmile-modal-root';\r\n      document.body.appendChild(root);\r\n    }\r\n    setPortalRoot(root);\r\n\r\n    return () => {\r\n      if (root && root.childElementCount === 0) {\r\n        document.body.removeChild(root);\r\n      }\r\n    };\r\n  }, []);\r\n  \r\n  // Initialize quality selection\r\n  useEffect(() => {\r\n    if (productInfo) {\r\n      if (productInfo.urgency_price && Object.keys(productInfo.urgency_price).length > 0) {\r\n        const qualities = Object.keys(productInfo.urgency_price);\r\n        setSelectedQuality(qualities[0]);\r\n      } else {\r\n        // Default to 'like new' if no urgency_price available\r\n        setSelectedQuality('like new');\r\n        \r\n        // Set current price from the API's discounted_price or calculate discount\r\n        if (productInfo.discounted_price) {\r\n          setCurrentPrice(typeof productInfo.discounted_price === 'string' ? \r\n            productInfo.discounted_price : \r\n            formatPrice(productInfo.discounted_price));\r\n        } else if (productInfo.original_price) {\r\n          // Fallback to 15% off original price if no discount specified\r\n          const discountedPrice = typeof productInfo.original_price === 'number' ? \r\n            productInfo.original_price * 0.85 : \r\n            parseFloat(productInfo.original_price) * 0.85;\r\n          setCurrentPrice(formatPrice(discountedPrice));\r\n        }\r\n      }\r\n    }\r\n  }, [productInfo]);\r\n\r\n  // Update info when quality changes\r\n  useEffect(() => {\r\n    if (selectedQuality && productInfo) {\r\n      // Price handling\r\n      let price;\r\n      if (productInfo.urgency_price && productInfo.urgency_price[selectedQuality]) {\r\n        price = productInfo.urgency_price[selectedQuality];\r\n      } else if (productInfo.discounted_price) {\r\n        price = productInfo.discounted_price;\r\n      } else if (productInfo.original_price) {\r\n        // Default to 15% discount if no specific discount is provided\r\n        price = typeof productInfo.original_price === 'number' ? \r\n          productInfo.original_price * 0.85 : \r\n          parseFloat(productInfo.original_price) * 0.85;\r\n      }\r\n      \r\n      // Handle both string format \"$199.98\" and numeric format\r\n      if (typeof price === 'string' && price.startsWith('$')) {\r\n        setCurrentPrice(price);\r\n      } else if (price !== undefined) {\r\n        setCurrentPrice(formatPrice(price));\r\n      }\r\n      \r\n      // Remarks handling\r\n      setCurrentRemarks(\r\n        productInfo.inspection?.[selectedQuality] || \r\n        'This item was previously purchased and returned in perfect condition. It has been thoroughly inspected and certified by our quality team.'\r\n      );\r\n      \r\n      // Image handling - handle empty array or undefined\r\n      const qualityImages = productInfo.images?.[selectedQuality] || [];\r\n      \r\n      // If no images, create a placeholder\r\n      if (!qualityImages.length) {\r\n        // Use a placeholder image url\r\n        setImages(['https://placehold.co/300x300?text=No+Image']);\r\n      } else {\r\n        setImages(qualityImages);\r\n      }\r\n      \r\n      setCurrentImageIndex(0);\r\n    }\r\n  }, [selectedQuality, productInfo]);\r\n\r\n  const formatPrice = (price: number | string) => {\r\n    const numPrice = typeof price === 'string' ? parseFloat(price) : price;\r\n    return new Intl.NumberFormat('en', {\r\n      style: 'currency',\r\n      currency: currency,\r\n      currencyDisplay: 'narrowSymbol'\r\n    }).format(numPrice);\r\n  };\r\n\r\n  // Event handlers\r\n  const handleQualitySelect = (quality: string) => {\r\n    setSelectedQuality(quality);\r\n    setShowDropdown(false);\r\n  };\r\n\r\n  const handlePrevImage = () => {\r\n    setCurrentImageIndex(prev => Math.max(0, prev - 1));\r\n  };\r\n\r\n  const handleNextImage = () => {\r\n    setCurrentImageIndex(prev => Math.min(images.length - 1, prev + 1));\r\n  };\r\n\r\n  // Close modal on Escape\r\n  useEffect(() => {\r\n    if (typeof window === 'undefined') return; // Check for browser environment\r\n    \r\n    const handleEscape = (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape') onClose();\r\n    };\r\n    window.addEventListener('keydown', handleEscape);\r\n    return () => window.removeEventListener('keydown', handleEscape);\r\n  }, [onClose]);\r\n\r\n  if (!portalRoot) return null;\r\n  \r\n  return ReactDOM.createPortal(\r\n    <div className=\"gm-modal-overlay\" onClick={onClose}>\r\n      <div className=\"gm-modal-content\" onClick={e => e.stopPropagation()}>\r\n        {/* Header */}\r\n        <div className=\"gm-modal-header\">\r\n          <h3 className=\"gm-modal-title\">Like-New Return Available</h3>\r\n          <button className=\"gm-close-button\" onClick={onClose}>\r\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n              <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\r\n              <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\r\n            </svg>\r\n          </button>\r\n        </div>\r\n        \r\n        {/* Image Slider */}\r\n        <div className=\"gm-product-slider\">\r\n          {images.length > 0 ? (\r\n            <img \r\n              src={images[currentImageIndex]} \r\n              alt={`${productTitle} - image ${currentImageIndex + 1}`}\r\n              className=\"gm-product-image\"\r\n            />\r\n          ) : (\r\n            <div className=\"gm-no-image\">No image available</div>\r\n          )}\r\n          \r\n          {images.length > 1 && (\r\n            <>\r\n              <button \r\n                className=\"gm-slider-arrow gm-slider-prev\"\r\n                onClick={handlePrevImage}\r\n                disabled={currentImageIndex === 0}\r\n              >\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n                  <polyline points=\"15 18 9 12 15 6\"></polyline>\r\n                </svg>\r\n              </button>\r\n              <button \r\n                className=\"gm-slider-arrow gm-slider-next\"\r\n                onClick={handleNextImage}\r\n                disabled={currentImageIndex === images.length - 1}\r\n              >\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n                  <polyline points=\"9 18 15 12 9 6\"></polyline>\r\n                </svg>\r\n              </button>\r\n            </>\r\n          )}\r\n        </div>\r\n        \r\n        {/* Product Info */}\r\n        <div className=\"gm-product-details\">\r\n          <div className=\"gm-product-brand\">\r\n            {productVendor && <h4 className=\"gm-vendor\">{productVendor.toUpperCase()}</h4>}\r\n            <h2 className=\"gm-product-title\">{productTitle}</h2>\r\n          </div>\r\n          \r\n          {/* Price Information */}\r\n          <div className=\"gm-price-section\">\r\n            <div className=\"gm-price-row\">\r\n              <div className=\"gm-price-label\">Original Price</div>\r\n              <div className=\"gm-price-value\">{productInfo?.price || formatPrice(productInfo?.original_price || 0)}</div>\r\n            </div>\r\n            <div className=\"gm-price-row\">\r\n              <div className=\"gm-restock-label\">Restock Price</div>\r\n              <div className=\"gm-restock-price\">{productInfo?.discounted_price || currentPrice}</div>\r\n            </div>\r\n          </div>\r\n          \r\n          {/* Item Description */}\r\n          <div className=\"gm-item-description\">\r\n            <h5 className=\"gm-description-title\">Item Description</h5>\r\n            \r\n            <div className=\"gm-description-content\">\r\n              <div className=\"gm-quality-indicator\">\r\n                <span className=\"gm-quality-dot\"></span>\r\n                <span className=\"gm-quality-label\">{selectedQuality?.toUpperCase() || 'LIKE NEW'}</span>\r\n              </div>\r\n              <div className=\"gm-remarks-title\">Tags and packaging intact.</div>\r\n              \r\n              <p className=\"gm-remarks-text\">\r\n                {currentRemarks || 'This item was previously purchased and returned in perfect condition. It has been thoroughly inspected and certified by our quality team, allowing us to offer it at a reduced price.'}\r\n              </p>\r\n            </div>\r\n          </div>\r\n\r\n          {/* CTA Button */}\r\n          <div className=\"gm-cta-container\">\r\n            <button \r\n              className=\"gm-cta-button\"\r\n              onClick={onCheckout}\r\n            >\r\n              GET THIS DEAL · {currentPrice}\r\n            </button>\r\n            <div className=\"gm-final-sale\">Final sale, no returns.</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>,\r\n    portalRoot\r\n  );\r\n};\r\n\r\nexport default ProductModal;\r\n","// src/components/GreenMileWidget.tsx\r\nimport React, { useEffect, useState } from 'react';\r\nimport ProductModal from './ProductModal';\r\nimport '../styles/GreenMileWidget.css';\r\n\r\ninterface GreenMileWidgetProps {\r\n  // Required props\r\n  productId: string;\r\n  productTitle: string;\r\n  productVendor?: string;\r\n  productPrice: number;\r\n  discountedPrice: number;\r\n  variantId: string;\r\n\r\n  \r\n  // Optional props\r\n  currency?: string;\r\n  backendUrl?: string;\r\n  storeUrl?: string;\r\n  onCheckout?: (variantId: string, discountCode: string) => void;\r\n  apiClient?: any;\r\n  \r\n}\r\n\r\nconst GreenMileWidget: React.FC<GreenMileWidgetProps> = ({\r\n  productId,\r\n  productTitle,\r\n  productVendor = '',\r\n  productPrice,\r\n  discountedPrice,\r\n  variantId,\r\n  currency = 'USD',\r\n  backendUrl,\r\n  storeUrl,\r\n  apiClient,\r\n  onCheckout,\r\n}) => {\r\n  const [showModal, setShowModal] = useState(false);\r\n  const [productInfo, setProductInfo] = useState<any>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  \r\n  useEffect(() => {\r\n    const fetchProductInfo = async () => {\r\n      try {\r\n        setLoading(true);\r\n        \r\n        // Get location using IP info\r\n        const locationResponse = await fetch('https://ipinfo.io/json?token=0938f3aebe35e7');\r\n        const locationData = await locationResponse.json();\r\n        const [latitude, longitude] = locationData.loc.split(',');\r\n        \r\n        // Call GreenMile API\r\n        const response = await fetch(`${backendUrl}/medusa/product-info/`, {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'ngrok-skip-browser-warning': '69420',\r\n          },\r\n          body: JSON.stringify({\r\n            shop: storeUrl,\r\n            product_price: productPrice,\r\n            product_id: productId,\r\n            variant_id: variantId,\r\n            variant: \"Default\",\r\n            location: {\r\n              latitude,\r\n              longitude\r\n            }\r\n          })\r\n        });\r\n        \r\n        let data = await response.json();\r\n        setProductInfo(data);\r\n      } catch (error) {\r\n        console.error('Error fetching product info:', error);\r\n        setError('Unable to load product information');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    \r\n    fetchProductInfo();\r\n  }, [productId, variantId, productPrice, backendUrl, storeUrl]);\r\n  \r\n  const handleCheckout = async() => {\r\n    try {\r\n      if (productInfo?.returned_variant) {\r\n        const countryCode = typeof window !== 'undefined' && window.location.pathname.split('/')[1] || 'dk';\r\n        \r\n        // If custom checkout handler is provided, use it\r\n        if (typeof onCheckout === 'function') {\r\n          onCheckout(productInfo.returned_variant, productInfo.discount_code || '');\r\n        } else {          // Otherwise, use our built-in directCheckout\r\n          if (typeof window !== 'undefined') {\r\n            // Import is done dynamically to avoid issues with server-side rendering\r\n            const { directCheckout } = await import('../utils/directCheckout');\r\n            await directCheckout(productInfo.returned_variant, 1, countryCode, apiClient);\r\n          }\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Checkout failed:\", error);\r\n    }\r\n  };\r\n  \r\n  if (loading) {\r\n    return <div className=\"gm-loading\">Loading product information...</div>;\r\n  }\r\n  \r\n  // Don't render the widget if there's an error, no product info\r\n  if (error || !productInfo) {\r\n    console.error(\"Error or no product info:\", error);\r\n    return null;\r\n  }\r\n  \r\n  // Parse price values from API response\r\n  const apiOriginalPrice = productInfo.price;\r\n  const apiDiscountedPrice = productInfo.discounted_price;\r\n  \r\n  const formatPrice = (price: number | string | undefined) => {\r\n    if (price == null) return '';\r\n    \r\n    // If price is already a formatted string (like \"$15.00\"), return it directly\r\n    if (typeof price === 'string' && price.startsWith('$')) {\r\n      return price;\r\n    }\r\n    \r\n    // Otherwise format it\r\n    const numPrice = typeof price === 'string' ? parseFloat(price) : price;\r\n    if (isNaN(numPrice)) return '';\r\n    \r\n    return new Intl.NumberFormat('en', {\r\n      style: 'currency',\r\n      currency: currency,\r\n      currencyDisplay: 'narrowSymbol'\r\n    }).format(numPrice);\r\n  };\r\n  \r\n  return (\r\n    <div className=\"gm-widget\">\r\n      <div className=\"deal-card\">\r\n        {/* Header with Like-New Return Available and GreenMile logo */}\r\n        <div className=\"gm-header\">\r\n          <div className=\"green-text\">Like-New Return Available</div>\r\n          <div className=\"gm-powered-by\">\r\n            Powered by GreenMile\r\n            <img \r\n              src=\"https://i.ibb.co/Rkr0W5dx/Green-Mile-Symbol.png\"\r\n              alt=\"GreenMile\"\r\n              width={16}\r\n              height={16}\r\n              className=\"gm-logo\"\r\n            />\r\n          </div>\r\n        </div>\r\n        \r\n        {/* Main Content */}\r\n        <div className=\"gm-content\">\r\n          {/* Deal button */}\r\n          <button \r\n            className=\"gm-buy-button\"\r\n            onClick={() => setShowModal(true)}\r\n          >\r\n            <span className=\"gm-button-text\">GET THIS DEAL</span>\r\n            <div className=\"gm-price-container\">\r\n              <span className=\"gm-original-price\">\r\n                {apiOriginalPrice || formatPrice(productPrice)}\r\n              </span>\r\n              <span className=\"gm-discount-price\">\r\n                {apiDiscountedPrice || formatPrice(discountedPrice)}\r\n              </span>\r\n            </div>\r\n          </button>\r\n          \r\n          {/* Features */}\r\n          <div className=\"gm-features\">\r\n            <div className=\"gm-feature-item\">\r\n              <span className=\"check-icon\">Like-New Condition</span>\r\n            </div>\r\n            <div className=\"gm-feature-item\">\r\n              <span className=\"check-icon\">Quality Checked</span>\r\n            </div>\r\n            <div className=\"gm-feature-item\">\r\n              <span className=\"check-icon\">Fast Shipping</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>      {/* Product Modal */}\r\n      {showModal && (\r\n        <ProductModal\r\n          productInfo={productInfo}\r\n          productTitle={productTitle}\r\n          productVendor={productVendor}\r\n          currency={currency}\r\n          onClose={() => setShowModal(false)}\r\n          onCheckout={handleCheckout}\r\n          apiClient={apiClient}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default GreenMileWidget;\r\n","// src/utils/directCheckout.ts\r\nimport { ProductVariant } from './variantFilter';\r\n\r\n/**\r\n * Interface for cart items used in the cart operations\r\n */\r\nexport interface CartItem {\r\n    id: string;\r\n    title: string;\r\n    variant?: {\r\n        title?: string;\r\n        [key: string]: any;\r\n    };\r\n    [key: string]: any;\r\n}\r\n\r\n/**\r\n * Checks if a variant name contains \"greenmile\"\r\n * \r\n * @param variant - The product variant to check\r\n * @returns true if the variant is a greenmile variant\r\n */\r\nexport function isGreenmileVariant(variant: ProductVariant | null): boolean {\r\n    if (!variant || !variant.title) return false\r\n    // Case-insensitive check\r\n    return variant.title.toLowerCase().includes(\"greenmile\")\r\n}\r\n\r\n/**\r\n * Creates a new cart with the specified greenmile variant and redirects to checkout\r\n * This bypasses the normal cart flow\r\n * \r\n * @param variantId - The ID of the greenmile variant\r\n * @param quantity - The quantity to add\r\n * @param countryCode - The country code for the region\r\n * @param sdk - Optional Medusa JS SDK instance (will use global sdk if available in browser environment)\r\n */\r\nexport async function directCheckout(\r\n    variantId: string,\r\n    quantity: number = 1,\r\n    countryCode: string,\r\n    sdk?: any\r\n\r\n): Promise<void> {\r\n    try {\r\n        console.log(`Starting direct checkout with variant: ${variantId}, quantity: ${quantity}, country: ${countryCode}`);\r\n\r\n        let medusaSdk: any;\r\n\r\n        // Try to get SDK from parameter or global\r\n        if (sdk) {\r\n            medusaSdk = sdk;\r\n        } else if (typeof window !== 'undefined' && (window as any).sdk) {\r\n            medusaSdk = (window as any).sdk;\r\n        } else {\r\n            throw new Error('Medusa SDK not available');\r\n        }\r\n\r\n        // Get all regions first\r\n        const regionsResponse = await medusaSdk.client.fetch(\r\n            `/store/regions`,\r\n            { method: \"GET\" }\r\n        )\r\n\r\n        console.log(`Retrieved regions:`, regionsResponse.regions);\r\n\r\n        // Find the region that contains the given country code\r\n        const region = regionsResponse.regions?.find((region: any) =>\r\n            region.countries?.some((country: any) =>\r\n                country.iso_2 === countryCode.toLowerCase()\r\n            )\r\n        )\r\n\r\n        if (!region?.id) {\r\n            console.error(`Region not found for country code: ${countryCode}`);\r\n            throw new Error(`Region not found for country code: ${countryCode}`)\r\n        }\r\n\r\n        console.log(`Found region: ${region.id} for country: ${countryCode}`);\r\n\r\n        // Create new cart with the found region ID\r\n        let cartResponse;\r\n        try {\r\n            cartResponse = await medusaSdk.store.cart.create({\r\n                region_id: region.id\r\n            })\r\n        } catch (err) {\r\n            console.error(\"Error creating cart:\", err);\r\n            throw err;\r\n        }\r\n\r\n        const cartId = cartResponse.cart.id;\r\n        console.log(`Created cart: ${cartId}`);\r\n\r\n        // Add the greenmile variant to the cart\r\n        let lineItemResponse;\r\n        try {\r\n            lineItemResponse = await medusaSdk.store.cart.createLineItem(cartId, {\r\n                variant_id: variantId,\r\n                quantity: quantity\r\n            })\r\n\r\n            console.log(`Added line item to cart:`, lineItemResponse);\r\n\r\n            // Check the cart after adding item to ensure it has items with prices\r\n            const updatedCart = await medusaSdk.store.cart.retrieve(cartId);\r\n            console.log(`Cart after adding item:`, updatedCart);\r\n\r\n            if (!updatedCart.cart.items || updatedCart.cart.items.length === 0) {\r\n                console.error(\"No items found in cart after adding line item.\");\r\n                throw new Error(\"Failed to add item to cart\");\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error adding item to cart:\", error);\r\n            throw error;\r\n        }\r\n\r\n\r\n        // Set cart cookie - this ensures the cart is accessible in checkout\r\n        if (typeof document !== 'undefined') {\r\n            document.cookie = `_greenmile_cart_id=${cartId}`\r\n            // Get the base URL from the current window location\r\n            const baseUrl = window.location.origin;\r\n\r\n            // Redirect directly to checkout address step with correct URL structure\r\n            const checkoutUrl = `${baseUrl}/${countryCode}/checkout?step=address`;\r\n            console.log(`Redirecting to: ${checkoutUrl}`);\r\n            window.location.href = checkoutUrl;\r\n        } else {\r\n            console.log(`Cart created with ID ${cartId}, but not in browser environment to set cookie and redirect`);\r\n            return;\r\n        }\r\n    } catch (error) {\r\n        console.error(\"Direct checkout failed:\", error)\r\n        throw error\r\n    }\r\n}\r\n\r\n/**\r\n * Removes all Greenmile products from the current cart.\r\n * @param retrieveCartFn - Function to retrieve the current cart\r\n * @param deleteLineItemFn - Function to delete a line item from the cart\r\n * @returns {Promise<{ success: boolean, isEmpty: boolean }>}\r\n */\r\nexport const removeGreenmileProducts = async (\r\n    retrieveCartFn: () => Promise<any>,\r\n    deleteLineItemFn: (lineItemId: string) => Promise<any>\r\n): Promise<{ success: boolean, isEmpty: boolean }> => {\r\n    try {\r\n        const cart = await retrieveCartFn();\r\n\r\n        if (!cart || !cart.id || !Array.isArray(cart.items)) {\r\n            console.error(\"Cart not found or invalid\");\r\n            return { success: false, isEmpty: true };\r\n        }\r\n\r\n        const isGreenmileProduct = (title: string): boolean => {\r\n            const brand = title?.split(\"-\")[0]?.trim().toLowerCase();\r\n            return brand === \"greenmile\";\r\n        };\r\n\r\n        const items: CartItem[] = cart.items;\r\n        const greenmileItems = items.filter(item => isGreenmileProduct(item.title));\r\n\r\n        if (greenmileItems.length === 0) {\r\n            return { success: true, isEmpty: items.length === 0 };\r\n        }\r\n\r\n        // Retry logic for deletion\r\n        const retry = async (fn: () => Promise<void>, retries = 2): Promise<void> => {\r\n            for (let i = 0; i <= retries; i++) {\r\n                try {\r\n                    await fn();\r\n                    return;\r\n                } catch (err) {\r\n                    if (i === retries) throw err;\r\n                    await new Promise(res => setTimeout(res, 300 * (i + 1)));\r\n                }\r\n            }\r\n        };\r\n\r\n        const deletePromises = greenmileItems.map(item =>\r\n            retry(() => deleteLineItemFn(item.id))\r\n        );\r\n\r\n        await Promise.all(deletePromises);\r\n\r\n        const updatedCart = await retrieveCartFn();\r\n        const isEmpty = !updatedCart || updatedCart.items.length === 0;\r\n\r\n        return { success: true, isEmpty };\r\n    } catch (error: unknown) {\r\n        console.error(\"Failed to remove Greenmile products:\", error);\r\n        return { success: false, isEmpty: false };\r\n    }\r\n};\r\n\r\n/**\r\n * Checks if there are any Greenmile variants in the cart.\r\n * @param retrieveCartFn - Function to retrieve the current cart\r\n * @returns {Promise<boolean>} - True if cart contains Greenmile variants, false otherwise.\r\n */\r\nexport const hasGreenmileInCart = async (\r\n    retrieveCartFn: () => Promise<any>\r\n): Promise<boolean> => {\r\n    try {\r\n        const cart = await retrieveCartFn()\r\n        if (!cart?.items?.length) return false\r\n\r\n        // Check if any cart item is a Greenmile variant\r\n        return cart.items.some((item: CartItem) =>\r\n            item.variant ? isGreenmileVariant(item.variant as ProductVariant) : false\r\n        )\r\n    } catch (error) {\r\n        console.error(\"Error checking for Greenmile variants in cart:\", error)\r\n        return false\r\n    }\r\n}\r\n","import { isGreenmileVariant } from \"../utils/directCheckout\"\r\n\r\n/**\r\n * Cart validator to prevent adding Greenmile variants to cart\r\n * @param variantId - The ID of the variant to check\r\n * @returns Promise that resolves to true if the variant can be added to cart, false otherwise\r\n */\r\nexport async function validateVariantForCart(\r\n    variantId: string\r\n): Promise<boolean> {\r\n    try {\r\n        // Fetch variant data to determine if it's a Greenmile variant\r\n        const response = await fetch(`/store/variants/${variantId}`)\r\n        if (!response.ok) {\r\n            // If we can't fetch the variant, allow adding to cart as a fallback\r\n            console.error(\"Failed to fetch variant for cart validation:\", response.status)\r\n            return true\r\n        }\r\n\r\n        const data = await response.json()\r\n        const variant = data.variant as any\r\n        // If it's a Greenmile variant, prevent adding to cart\r\n        if (isGreenmileVariant(variant)) {\r\n            console.warn(\"Prevented adding Greenmile variant to cart:\", variant.title)\r\n            return false\r\n        }\r\n\r\n        // Allow other variants\r\n        return true\r\n    } catch (error) {\r\n        console.error(\"Error in cart validation:\", error)\r\n        // In case of error, allow adding to cart as a fallback\r\n        return true\r\n    }\r\n}\r\n\r\n/**\r\n * This function decorates the cart's addItem method to intercept\r\n * and block Greenmile variants from being added to cart\r\n */\r\nexport function setupCartInterceptor() {\r\n    // Check if we're in the browser\r\n    if (typeof window === 'undefined') {\r\n        return\r\n    }\r\n\r\n    // Listen for cart add events (using a custom approach since Medusa doesn't provide direct hooks)\r\n    document.addEventListener('click', async (event) => {\r\n        const target = event.target as HTMLElement\r\n\r\n        // Check if this is an Add to Cart button click\r\n        if (\r\n            (target.tagName === 'BUTTON' && target.innerText.includes('Add to cart')) ||\r\n            target.closest('[data-testid=\"add-product-button\"]') ||\r\n            target.closest('[data-testid=\"mobile-cart-button\"]')\r\n        ) {\r\n            // Find product page variant selection\r\n            const variantInfo = document.querySelector('[data-variant-id]')\r\n            if (variantInfo) {\r\n                const variantId = variantInfo.getAttribute('data-variant-id')\r\n\r\n                if (variantId) {\r\n                    // If it's a Greenmile variant, prevent default cart flow\r\n                    const isValid = await validateVariantForCart(variantId)\r\n\r\n                    if (!isValid) {\r\n                        event.preventDefault()\r\n                        event.stopPropagation()\r\n\r\n                        // Show message to user\r\n                        alert(\"This is a GreenMile product. Please use the Buy Now button for direct checkout.\")\r\n\r\n                        return false\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }, true)\r\n}","// src/utils/variantFilter.ts\r\n\r\n/**\r\n * Product variant interface - simplified version of Medusa's types \r\n */\r\nexport interface ProductVariant {\r\n    id?: string;\r\n    title?: string;\r\n    prices?: { amount?: number; currency_code?: string }[];\r\n    [key: string]: any;\r\n}\r\n\r\n/**\r\n * Product option interface - simplified version of Medusa's types\r\n */\r\nexport interface ProductOption {\r\n    id?: string;\r\n    title?: string;\r\n    values?: { value?: string;[key: string]: any }[];\r\n    [key: string]: any;\r\n}\r\n\r\n/**\r\n * Product interface - simplified version of Medusa's types\r\n */\r\nexport interface Product {\r\n    id?: string;\r\n    title?: string;\r\n    description?: string;\r\n    variants?: ProductVariant[];\r\n    options?: ProductOption[];\r\n    [key: string]: any;\r\n}\r\n\r\n/**\r\n * Filter options for product variants\r\n */\r\nexport interface VariantFilterOptions {\r\n    /**\r\n     * Prefixes to exclude (case insensitive)\r\n     */\r\n    excludePrefixes?: string[];\r\n\r\n    /**\r\n     * Custom filter function\r\n     */\r\n    customFilter?: (variant: ProductVariant) => boolean;\r\n}\r\n\r\n/**\r\n * Default options\r\n */\r\nconst defaultOptions: VariantFilterOptions = {\r\n    excludePrefixes: [],\r\n    customFilter: undefined,\r\n};\r\n\r\n/**\r\n * Checks if a string starts with any of the excluded prefixes\r\n * @param text - String to check\r\n * @param excludePrefixes - Array of prefixes to exclude\r\n * @returns true if the string starts with any excluded prefix\r\n */\r\nfunction startsWithExcludedPrefix(text: string, excludePrefixes: string[]): boolean {\r\n    if (!text || !excludePrefixes || excludePrefixes.length === 0) {\r\n        return false;\r\n    }\r\n\r\n    const lowerText = text.toLowerCase();\r\n    return excludePrefixes.some(prefix =>\r\n        lowerText.startsWith(prefix.toLowerCase())\r\n    );\r\n}\r\n\r\n/**\r\n * Filters product options based on excluded prefixes\r\n * @param options - Product options array\r\n * @param excludePrefixes - Prefixes to exclude\r\n * @returns Filtered options array\r\n */\r\nfunction filterProductOptions(\r\n    options: ProductOption[],\r\n    excludePrefixes: string[]\r\n): ProductOption[] {\r\n    if (!options || options.length === 0 || !excludePrefixes || excludePrefixes.length === 0) {\r\n        return options;\r\n    }\r\n\r\n    return options.map(option => {\r\n        // Keep the option but filter its values\r\n        return {\r\n            ...option,\r\n            values: option.values ? option.values.filter((value) =>\r\n                !startsWithExcludedPrefix(value.value ?? '', excludePrefixes)\r\n            ) :\r\n                []\r\n        };\r\n    });\r\n}\r\n\r\n/**\r\n * Filters variants from a Medusa product based on provided options\r\n * @param product - The Medusa product with variants to filter\r\n * @param options - Filter options\r\n * @returns A new product object with filtered variants\r\n */\r\nexport function filterVariants(\r\n    product: Product,\r\n    options: VariantFilterOptions = defaultOptions\r\n): Product {\r\n    const mergedOptions = { ...defaultOptions, ...options };\r\n\r\n    if (!product) {\r\n        return product;\r\n    }\r\n\r\n    // Filter variants\r\n    const filteredVariants = product.variants ?\r\n        product.variants.filter((variant: ProductVariant) => {\r\n            // Skip if no title\r\n            if (!variant.title) return true;\r\n\r\n            // Check prefix exclusions\r\n            if (mergedOptions.excludePrefixes && mergedOptions.excludePrefixes.length > 0) {\r\n                if (startsWithExcludedPrefix(variant.title, mergedOptions.excludePrefixes)) {\r\n                    return false;\r\n                }\r\n            }\r\n\r\n            // Apply custom filter if provided\r\n            if (mergedOptions.customFilter) {\r\n                return mergedOptions.customFilter(variant);\r\n            }\r\n\r\n            return true;\r\n        }) : [];\r\n\r\n    // Filter options\r\n    const filteredOptions = product.options ?\r\n        filterProductOptions(product.options, mergedOptions.excludePrefixes || []) :\r\n        [];\r\n\r\n    return {\r\n        ...product,\r\n        variants: filteredVariants,\r\n        options: filteredOptions\r\n    };\r\n}\r\n","interface determineCartSourceProps {\r\n    retrieveCartFunc: () => Promise<any>\r\n}\r\n\r\n\r\n/**\r\n * Determines the source of the cart items (greenmile or medusa)\r\n * This helps with routing to the appropriate checkout flow\r\n * @returns \"greenmile\" if the cart contains GreenMile items, \"medusa\" otherwise\r\n */\r\nexport async function determineCartSource({ retrieveCartFunc: retrieveCart }: determineCartSourceProps): Promise<string> {\r\n    try {\r\n        const cart = await retrieveCart();\r\n        // If cart is empty or has no items, default to medusa\r\n        if (!cart || !cart.items || cart.items.length === 0) {\r\n            return \"medusa\";\r\n        }\r\n        // Check if the first item has a title starting with \"greenmile\"\r\n        if (cart.items[0].title &&\r\n            cart.items[0].title.split('-')[0].toLowerCase() === 'greenmile') {\r\n            return \"greenmile\";\r\n        }\r\n        // Default to medusa for all other cases\r\n        return \"medusa\";\r\n    } catch (error) {\r\n        console.error(\"Error determining cart source:\", error);\r\n        // Default to medusa on error\r\n        return \"medusa\";\r\n    }\r\n}","import { useEffect, useState, Fragment } from \"react\"\r\n\r\nimport { removeGreenmileProducts } from \"../utils\"\r\nimport { isGreenmileVariant } from \"../utils\"\r\nimport { Dialog, Transition } from \"@headlessui/react\"\r\nimport { Text, Button } from \"@medusajs/ui\"\r\n\r\n\r\ninterface cartValidatorProps \r\n{\r\n    retrieveCartFunc: ()=> Promise<any>\r\n    deleteLineItems:()=> Promise<any>\r\n    pathname :string\r\n}\r\n\r\nexport default function CartValidator({retrieveCartFunc:retrieveCart,pathname,deleteLineItems}:cartValidatorProps) {\r\n  const [isOpen, setIsOpen] = useState(false)\r\n  const [greenmileVariants, setGreenmileVariants] = useState<any[]>([])\r\n  const [isLoading, setIsLoading] = useState(false)\r\n\r\n  // Check cart on mount\r\n  useEffect(() => {\r\n    // Don't show validator on checkout page\r\n    if (pathname.includes('/checkout')) {\r\n      return\r\n    }\r\n\r\n    const checkCart = async () => {\r\n      try {\r\n        const cart = await retrieveCart()\r\n        if (!cart || !cart.items) return\r\n\r\n        // Find any Greenmile variants in the cart\r\n        const greenmileItems = cart.items\r\n         //@ts-ignore\r\n         .filter(item => isGreenmileVariant(item.variant))\r\n         //@ts-ignore\r\n          .map(item => item.variant)\r\n\r\n        if (greenmileItems.length > 0) {\r\n          setGreenmileVariants(greenmileItems)\r\n          setIsOpen(true)\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error checking cart for Greenmile variants:\", error)\r\n      }\r\n    }\r\n\r\n    checkCart()\r\n  }, [pathname])\r\n\r\n  // Close the dialog\r\n  const closeDialog = () => {\r\n    setIsOpen(false)\r\n  }\r\n\r\n  // Handle direct checkout\r\n  const handleDirectCheckout = () => {\r\n    // First close the dialog\r\n    closeDialog()\r\n    // Then redirect to checkout\r\n    window.location.href = \"/checkout?step=address\"\r\n  }\r\n\r\n  // Handle removing Greenmile items\r\n  const handleRemoveItems = async () => {\r\n    setIsLoading(true)\r\n    try {\r\n      // First close the dialog\r\n      closeDialog()\r\n      // Then remove items\r\n      await removeGreenmileProducts(retrieveCart,deleteLineItems)\r\n      document.cookie = \"_medusa_cart_id=;path=/;\"\r\n\r\n\r\n      window.location.reload()\r\n    } catch (error) {\r\n      console.error(\"Error removing Greenmile items:\", error)\r\n    }\r\n    setIsLoading(false)\r\n  }\r\n\r\n  if (greenmileVariants.length === 0) {\r\n    return null\r\n  }\r\n\r\n  return (\r\n    <Transition appear show={isOpen} as={Fragment}>\r\n      <Dialog as=\"div\" className=\"relative z-50\" onClose={closeDialog}>\r\n        <Transition.Child\r\n          as={Fragment}\r\n          enter=\"ease-out duration-300\"\r\n          enterFrom=\"opacity-0\"\r\n          enterTo=\"opacity-100\"\r\n          leave=\"ease-in duration-200\"\r\n          leaveFrom=\"opacity-100\"\r\n          leaveTo=\"opacity-0\"\r\n        >\r\n          <div className=\"fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm\" />\r\n        </Transition.Child>\r\n\r\n        <div className=\"fixed inset-0 overflow-y-auto\">\r\n          <div className=\"flex min-h-full items-center justify-center p-4 text-center\">\r\n            <Transition.Child\r\n              as={Fragment}\r\n              enter=\"ease-out duration-300\"\r\n              enterFrom=\"opacity-0 scale-95\"\r\n              enterTo=\"opacity-100 scale-100\"\r\n              leave=\"ease-in duration-200\"\r\n              leaveFrom=\"opacity-100 scale-100\"\r\n              leaveTo=\"opacity-0 scale-95\"\r\n            >\r\n              <Dialog.Panel className=\"w-full max-w-md transform overflow-hidden rounded-2xl bg-white p-6 text-left align-middle shadow-xl transition-all\">\r\n                <Dialog.Title\r\n                  as=\"h3\"\r\n                  className=\"text-lg font-medium leading-6 text-gray-900\"\r\n                >\r\n                  Greenmile Products Detected\r\n                </Dialog.Title>\r\n                <div className=\"mt-2\">\r\n                  <Text className=\"text-sm text-gray-500\">\r\n                    We noticed your cart contains Greenmile products which require special handling.\r\n                  </Text>\r\n                  <Text className=\"mt-2 text-sm text-gray-500\">\r\n                    You can either proceed directly to checkout with these items or remove them from your cart.\r\n                  </Text>\r\n                  <div className=\"mt-4 bg-gray-50 p-4 rounded\">\r\n                    <Text className=\"font-medium\">Greenmile items in cart:</Text>\r\n                    <ul className=\"list-disc pl-5 mt-2\">\r\n                      {greenmileVariants.map((variant) => (\r\n                        <li key={variant.id} className=\"mt-1\">\r\n                          {variant.product?.title || \"Product\"} - {variant.title}\r\n                        </li>\r\n                      ))}\r\n                    </ul>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"mt-6 flex justify-end gap-3\">\r\n                  <Button \r\n                    variant=\"secondary\"\r\n                    onClick={handleRemoveItems}\r\n                    disabled={isLoading}\r\n                  >\r\n                    {isLoading ? \"Removing...\" : \"Remove Items\"}\r\n                  </Button>\r\n                  <Button \r\n                    className=\"bg-green-600 hover:bg-green-700\"\r\n                    onClick={handleDirectCheckout}\r\n                    disabled={isLoading}\r\n                  >\r\n                    Go to Checkout\r\n                  </Button>\r\n                </div>\r\n              </Dialog.Panel>\r\n            </Transition.Child>\r\n          </div>\r\n        </div>\r\n      </Dialog>\r\n    </Transition>\r\n  )\r\n}","\r\nimport { useEffect } from \"react\"\r\nimport { setupCartInterceptor } from \"../utils/cart-interceptor\"\r\nimport CartValidator from \"./cart-validator\"\r\n\r\ninterface DirectCheckoutProps {\r\n  retrieveCart:()=>Promise<any>\r\n  deleteLineItems:()=>Promise<any>\r\n  pathname:string\r\n  children: React.ReactNode\r\n}\r\n\r\n/**\r\n * Provider component that sets up cart interception for Greenmile variants\r\n * This should be included high in the application tree\r\n */\r\nconst DirectCheckoutProvider: React.FC<DirectCheckoutProps> = ({\r\n  children,\r\n  retrieveCart,\r\n  deleteLineItems,pathname\r\n}) => {\r\n  useEffect(() => {\r\n    // Set up cart interception when the component mounts\r\n    setupCartInterceptor()\r\n  }, [])\r\n\r\n  // Include the cart validator and render children\r\n  return (\r\n    <>\r\n      <CartValidator retrieveCartFunc={retrieveCart} deleteLineItems={deleteLineItems} pathname={pathname} />\r\n      {children}\r\n      </>\r\n  )\r\n}\r\n\r\nexport default DirectCheckoutProvider"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","__generator","body","f","y","_","label","sent","trys","ops","g","create","Iterator","verb","Symbol","iterator","v","op","TypeError","pop","push","styleInject","css","ref","insertAt","document","head","getElementsByTagName","style","createElement","type","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","SuppressedError","ProductModal","_a","productInfo","productTitle","_b","productVendor","_c","currency","onClose","onCheckout","apiClient","_d","useState","selectedQuality","setSelectedQuality","_e","_f","currentImageIndex","setCurrentImageIndex","_g","images","setImages","_h","currentRemarks","setCurrentRemarks","_j","currentPrice","setCurrentPrice","_k","portalRoot","setPortalRoot","useEffect","window","root","getElementById","id","childElementCount","removeChild","urgency_price","keys","qualities","discounted_price","formatPrice","original_price","discountedPrice","parseFloat","price","startsWith","undefined","inspection","qualityImages","numPrice","Intl","NumberFormat","currencyDisplay","format","handleEscape","key","addEventListener","removeEventListener","ReactDOM","createPortal","_jsx","className","onClick","children","_jsxs","stopPropagation","xmlns","width","height","viewBox","fill","stroke","strokeWidth","x1","y1","x2","y2","src","alt","concat","_Fragment","prev","Math","max","disabled","strokeLinecap","strokeLinejoin","points","min","toUpperCase","GreenMileWidget","productId","productPrice","variantId","backendUrl","storeUrl","showModal","setShowModal","setProductInfo","loading","setLoading","error","setError","fetch","json","locationData","loc","split","latitude","longitude","method","headers","JSON","stringify","shop","product_price","product_id","variant_id","variant","location","data","console","error_1","apiOriginalPrice","apiDiscountedPrice","isNaN","returned_variant","countryCode","pathname","discount_code","directCheckout$1","directCheckout","error_2","isGreenmileVariant","title","toLowerCase","includes","quantity","sdk","log","medusaSdk","Error","client","regionsResponse","regions","region","find","countries","some","country","iso_2","cartResponse","store","cart","region_id","err_1","cartId","lineItemResponse","createLineItem","retrieve","updatedCart","items","cookie","baseUrl","origin","checkoutUrl","href","removeGreenmileProducts","retrieveCartFn","deleteLineItemFn","Array","isArray","isGreenmileProduct_1","trim","greenmileItems","filter","item","success","isEmpty","retry_1","fn","retries","err_2","res","setTimeout","deletePromises","map","all","error_3","hasGreenmileInCart","error_4","validateVariantForCart","response","ok","status","warn","defaultOptions","excludePrefixes","customFilter","startsWithExcludedPrefix","text","lowerText","prefix","filterVariants","product","options","mergedOptions","filteredVariants","variants","filteredOptions","option","values","filterProductOptions","determineCartSource","retrieveCart","retrieveCartFunc","CartValidator","_this","deleteLineItems","isOpen","setIsOpen","greenmileVariants","setGreenmileVariants","isLoading","setIsLoading","closeDialog","Transition","appear","show","as","Fragment","Dialog","Child","enter","enterFrom","enterTo","leave","leaveFrom","leaveTo","Panel","Title","Text","Button","reload","DirectCheckoutProvider","event","target","tagName","innerText","closest","variantInfo","querySelector","getAttribute","preventDefault","alert","setupCartInterceptor"],"mappings":"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"}